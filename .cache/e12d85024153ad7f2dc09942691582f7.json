{"id":"fYL1","dependencies":[{"name":"/home/john/workspace/Valory2/tsconfig.json","includedInParent":true,"mtime":1531152310742},{"name":"/home/john/workspace/Valory2/package.json","includedInParent":true,"mtime":1533664046105},{"name":"/home/john/workspace/Valory2/.babelrc","includedInParent":true,"mtime":1533664058125},{"name":"./utils/pathUtils","loc":{"line":3,"column":28},"parent":"/home/john/workspace/Valory2/src/tsoa/specGenerator.ts","resolved":"/home/john/workspace/Valory2/src/tsoa/utils/pathUtils.ts"}],"generated":{"js":"var $fYL1$exports={};Object.defineProperty($fYL1$exports,\"__esModule\",{value:!0});const $fYL1$var$pathUtils_1=$parcel$require(\"fYL1\",\"./utils/pathUtils\"),$fYL1$var$lodash_1=require(\"lodash\");class $fYL1$var$SpecGenerator{constructor(e){this.metadata=e}GetSpec(){return{consumes:[\"application/json\"],definitions:this.buildDefinitions(),info:{title:\"\"},paths:this.buildPaths(),produces:[\"application/json\"],swagger:\"2.0\"}}buildDefinitions(){const e={};for(var t=Object.keys(this.metadata.referenceTypeMap),r=t=>{const r=this.metadata.referenceTypeMap[t];if(\"refObject\"===r.dataType||\"refEnum\"===r.dataType){if(r.properties){for(var a=r.properties.filter(e=>e.required),i=e=>e.name,o=[],s=0;s<a.length;s++)o.push(i(a[s]));const t=o;e[r.refName]={description:r.description,properties:this.buildProperties(r.properties),required:t&&t.length>0?Array.from(new Set(t)):void 0,type:\"object\"},r.additionalProperties&&(e[r.refName].additionalProperties=this.buildAdditionalProperties(r.additionalProperties))}r.example&&(e[r.refName].example=r.example),r.enums&&(e[r.refName]={description:r.description,enum:r.enums,type:\"string\"}),r.additionalSwagger&&(e[r.refName]=$fYL1$var$lodash_1.merge(e[r.refName],r.additionalSwagger))}if(\"refAlias\"===r.dataType){const t=this.getSwaggerType(r.type),a=r.format;if(t.description=r.description,t.format=a||t.format,t.example=r.example,!t.$ref)for(var n=Object.keys(r.validators).filter(e=>!e.startsWith(\"is\")&&\"minDate\"!==e&&\"maxDate\"!==e),p=e=>{t[e]=r.validators[e].value},d=0;d<n.length;d++)p(n[d]);e[r.refName]=t}},a=[],i=0;i<t.length;i++)a.push(r(t[i]));return e}buildPaths(){const e={};for(var t=this.metadata.controllers,r=t=>{const r=$fYL1$var$pathUtils_1.normalisePath(t.path,\"/\");for(var a=t.methods,i=a=>{const i=$fYL1$var$pathUtils_1.normalisePath(a.path,\"/\"),o=$fYL1$var$pathUtils_1.normalisePath(`${r}${i}`,\"/\",\"\",!1);e[o]=e[o]||{},this.buildMethod(t.name,a,e[o])},o=0;o<a.length;o++)i(a[o])},a=0;a<t.length;a++)r(t[a]);return e}buildMethod(e,t,r){const a=r[t.method]=this.buildOperation(e,t);if(a.description=t.description,a.summary=t.summary,a.tags=t.tags,t.deprecated&&(a.deprecated=t.deprecated),t.security){const e=[];for(const r of t.security){const t={};t[r.name]=r.scopes?r.scopes:[],e.push(t)}a.security=e}for(var i=t.parameters.filter(e=>!(\"request\"===e.in||\"body-prop\"===e.in||\"logger\"===e.in)),o=e=>this.buildParameter(e),s=[],n=0;n<i.length;n++)s.push(o(i[n]));a.parameters=s;const p=this.buildBodyPropParameter(e,t);if(p&&a.parameters.push(p),a.parameters.filter(e=>\"body\"===e.in).length>1)throw new Error(\"Only one body parameter allowed per controller method.\")}buildBodyPropParameter(e,t){const r={},a=[];for(var i=t.parameters.filter(e=>\"body-prop\"===e.in),o=e=>{if(r[e.name]=this.getSwaggerType(e.type),r[e.name].default=e.default,r[e.name].description=e.description,\"object\"===e.type.dataType){const t=this.buildLiteralObject(e.type);r[e.name].properties=t.properties,r[e.name].additionalProperties=t.additionalProperties,r[e.name].required=t.required,r[e.name].type=t.type,r[e.name].description=t.description}e.required&&a.push(e.name)},s=0;s<i.length;s++)o(i[s]);if(!Object.keys(r).length)return;const n={in:\"body\",name:\"body\",schema:{properties:r,title:`${this.getOperationId(t.name)}Body`,type:\"object\"}};return a.length&&(n.schema.required=a),n}buildParameter(e){let t={default:e.default,description:e.description,in:e.in,name:e.name,required:e.required};const r=this.getSwaggerType(e.type);if(t.format=r.format||void 0,\"query\"===t.in&&\"array\"===t.type&&(t.collectionFormat=\"multi\"),r.$ref)return t.schema=r,t;const a={};for(var i,o=Object.keys(e.validators).filter(e=>!e.startsWith(\"is\")&&\"minDate\"!==e&&\"maxDate\"!==e),s=0;s<o.length;s++)i=o[s],a[i]=e.validators[i].value;return\"object\"===e.type.dataType&&\"body\"===e.in&&(t.schema=this.buildLiteralObject(e.type)),\"body\"===e.in&&\"array\"===e.type.dataType?t.schema={items:r.items,type:\"array\"}:\"any\"===e.type.dataType?\"body\"===e.in?t.schema={type:\"object\"}:t.type=\"string\":\"body\"===e.in&&\"object\"===e.type.dataType||(t.type=r.type,t.items=r.items,t.enum=r.enum),null!=t.schema?t.schema=Object.assign({},t.schema,a):t=Object.assign({},t,a),t}buildLiteralObject(e){for(var t=e.properties.filter(e=>e.required),r=e=>e.name,a=[],i=0;i<t.length;i++)a.push(r(t[i]));const o=a,s={type:\"object\",properties:this.buildProperties(e.properties),required:o&&o.length>0?Array.from(new Set(o)):void 0,description:e.description};return e.additionalProperties&&(s.additionalProperties=this.buildAdditionalProperties(e.additionalProperties)),s}buildProperties(e){const t={};for(var r=e,a=e=>{const r=this.getSwaggerType(e.type),a=e.format;if(r.description=e.description,r.format=a||r.format,\"object\"===e.type.dataType){const t=this.buildLiteralObject(e.type);r.properties=t.properties,r.additionalProperties=t.additionalProperties,r.type=t.type,r.required=t.required,r.description=r.description?r.description:t.description}if(!r.$ref){r.default=e.default;for(var i=Object.keys(e.validators).filter(e=>!e.startsWith(\"is\")&&\"minDate\"!==e&&\"maxDate\"!==e),o=t=>{r[t]=e.validators[t].value},s=0;s<i.length;s++)o(i[s])}t[e.name]=r},i=0;i<r.length;i++)a(r[i]);return t}buildAdditionalProperties(e){return this.getSwaggerType(e)}buildOperation(e,t){const r={};for(var a=t.responses,i=e=>{r[e.name]={description:e.description},e.schema&&\"void\"!==e.schema.dataType&&(r[e.name].schema=this.getSwaggerType(e.schema)),e.examples&&(r[e.name].examples={\"application/json\":e.examples})},o=0;o<a.length;o++)i(a[o]);return{operationId:this.getOperationId(t.name),produces:[\"application/json\"],responses:r}}getOperationId(e){return e.charAt(0).toUpperCase()+e.substr(1)}getSwaggerType(e){const t=this.getSwaggerTypeForPrimitiveType(e);return t||(\"array\"===e.dataType?this.getSwaggerTypeForArrayType(e):\"enum\"===e.dataType?this.getSwaggerTypeForEnumType(e):this.getSwaggerTypeForReferenceType(e))}getSwaggerTypeForPrimitiveType(e){return{any:{type:\"object\"},binary:{type:\"string\",format:\"binary\"},boolean:{type:\"boolean\"},buffer:{type:\"string\",format:\"byte\"},byte:{type:\"string\",format:\"byte\"},date:{type:\"string\",format:\"date\"},datetime:{type:\"string\",format:\"date-time\"},double:{type:\"number\",format:\"double\"},float:{type:\"number\",format:\"float\"},integer:{type:\"integer\",format:\"int32\"},long:{type:\"integer\",format:\"int64\"},object:{type:\"object\"},string:{type:\"string\"}}[e.dataType]}getSwaggerTypeForArrayType(e){return{type:\"array\",items:this.getSwaggerType(e.elementType)}}getSwaggerTypeForEnumType(e){let t=!1;for(var r,a=e.enums,i=0;i<a.length;i++)r=a[i],$fYL1$var$lodash_1.isString(r)&&(t=!0);for(var o=e.enums,s=e=>t?String(e):e,n=[],p=0;p<o.length;p++)n.push(s(o[p]));return{type:t?\"string\":\"number\",enum:n}}getSwaggerTypeForReferenceType(e){return{$ref:`#/definitions/${e.refName}`}}}var $fYL1$export$SpecGenerator=$fYL1$var$SpecGenerator;$fYL1$exports.SpecGenerator=$fYL1$export$SpecGenerator;"},"hash":"fe908cd45bb90b2ec2fef8efebc7de89","cacheData":{"env":{},"imports":{},"exports":{"SpecGenerator":"$fYL1$export$SpecGenerator"},"wildcards":[],"isCommonJS":true}}