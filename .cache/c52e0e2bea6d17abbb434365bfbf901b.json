{"id":"c7M9","dependencies":[{"name":"/home/john/workspace/Valory2/tsconfig.json","includedInParent":true,"mtime":1531152310742},{"name":"/home/john/workspace/Valory2/package.json","includedInParent":true,"mtime":1533664046105},{"name":"/home/john/workspace/Valory2/.babelrc","includedInParent":true,"mtime":1533664058125},{"name":"./preprocessor","loc":{"line":15,"column":31},"parent":"/home/john/workspace/Valory2/src/compiler/compiler.ts","resolved":"/home/john/workspace/Valory2/src/compiler/preprocessor.ts"},{"name":"./method","loc":{"line":16,"column":25},"parent":"/home/john/workspace/Valory2/src/compiler/compiler.ts","resolved":"/home/john/workspace/Valory2/src/compiler/method.ts"},{"name":"./compilerheaders","loc":{"line":19,"column":34},"parent":"/home/john/workspace/Valory2/src/compiler/compiler.ts","resolved":"/home/john/workspace/Valory2/src/compiler/compilerheaders.ts"},{"name":"../server/valoryheaders","loc":{"line":21,"column":32},"parent":"/home/john/workspace/Valory2/src/compiler/compiler.ts","resolved":"/home/john/workspace/Valory2/src/server/valoryheaders.ts"},{"name":"../lib/helpers","loc":{"line":23,"column":26},"parent":"/home/john/workspace/Valory2/src/compiler/compiler.ts","resolved":"/home/john/workspace/Valory2/src/lib/helpers.ts"},{"name":"../lib/config","loc":{"line":24,"column":25},"parent":"/home/john/workspace/Valory2/src/compiler/compiler.ts","resolved":"/home/john/workspace/Valory2/src/lib/config.ts"}],"generated":{"js":"var $c7M9$exports={};$parcel$require(\"c7M9\",\"bluebird\"),$parcel$require(\"c7M9\",\"bluebird\");let $c7M9$var$compile=(()=>{var e=$c7M9$import$_coroutine(function*(e,r){const a={module:null,debugArtifacts:{hashes:[],preSwagger:null,derefSwagger:null,initialSchema:[],processedSchema:[],initialCompiles:[],mangledSchema:[],intermediateFunctions:[],intermediateModule:null,postCompileModule:null,closureOutput:{exitCode:null,stderr:null,stdout:null}}},$={requestFieldMapping:{body:\"body\",formData:\"formData\",header:\"headers\",path:\"path\",query:\"query\"},debug:!1,singleError:!0,compilationLevel:$c7M9$var$compilerheaders_1.CompilationLevel.ADVANCED,discrimFastFail:!1};$c7M9$var$lodash_1.merge($,r);const t=new $c7M9$var$Ajv({coerceTypes:!0,useDefaults:\"shared\",sourceCode:!0,errorDataPath:\"property\",unicode:!1,allErrors:!(r=$).singleError});r.discrimFastFail&&$c7M9$exports.CompileLog.warn(\"discriminator fast fail is enabled EXPERIMENTAL\");const i=$c7M9$var$config_1.Config.Spinner;console.log($c7M9$var$chalk_1.default.bold(\"Prepare Swagger\")),yield $c7M9$import$_resolve(i.start(\"Validating Swagger\"));try{yield $c7M9$import$_resolve($c7M9$var$swagger_parser_1.validate($c7M9$var$lodash_1.cloneDeep(e)))}catch(e){yield $c7M9$import$_resolve($c7M9$var$helpers_1.spinnerFail(\"Swagger Validation Failure\",e))}yield $c7M9$import$_resolve(i.succeed()),i.start(\"Preprocessing Swagger\");try{a.debugArtifacts.preSwagger=$c7M9$var$preprocessor_1.swaggerPreproccess($c7M9$var$lodash_1.cloneDeep(e))}catch(e){yield $c7M9$import$_resolve($c7M9$var$helpers_1.spinnerFail(\"Swagger Preprocessor Failure\",e))}yield $c7M9$import$_resolve(i.succeed()),i.start(\"Dereferencing Swagger\");try{a.debugArtifacts.derefSwagger=yield $c7M9$import$_resolve($c7M9$var$swagger_parser_1.dereference(a.debugArtifacts.preSwagger.swagger))}catch(e){yield $c7M9$import$_resolve($c7M9$var$helpers_1.spinnerFail(\"Swagger Dereference Failure\",e))}yield $c7M9$import$_resolve(i.succeed()),console.log($c7M9$var$chalk_1.default.bold(\"Build Endpoints\"));for(const e of Object.keys(a.debugArtifacts.derefSwagger.paths))for(const $ of Object.keys(a.debugArtifacts.derefSwagger.paths[e])){yield $c7M9$import$_resolve(i.start(\"Building method schema\"));const o=$c7M9$var$compilerheaders_1.FUNCTION_PREFIX+$c7M9$var$XXH.h32(`${e}:${$}`,$c7M9$var$compilerheaders_1.HASH_SEED).toString(),c=($c7M9$exports.CompileLog.child({endpoint:`${e}:${$}`,hash:o}),$c7M9$var$method_1.compileMethodSchema(a.debugArtifacts.derefSwagger.paths[e][$],$,e,r.requestFieldMapping));i.text=\"Preprocessing schema\";const s=$c7M9$var$preprocessor_1.schemaPreprocess(c);i.text=\"Compiling schema validator\";const l=t.compile(s.schema);i.text=\"Objectifying anyOf's\",$c7M9$var$preprocessor_1.resolve(s.resQueue),i.text=\"Mangling keys\";const p=$c7M9$var$preprocessor_1.mangleKeys(s.schema);i.text=\"Compiling intermediate validator function\";const n=$c7M9$var$templates.validatorTemplate({validate:l,funcName:e,localConsumes:a.debugArtifacts.derefSwagger.paths[e][$].consumes,hash:o,format:t._opts.format,mangledKeys:p.mangledKeys,schema:p.schema,singleError:r.singleError,discriminators:a.debugArtifacts.preSwagger.discriminators,discrimFastFail:r.discrimFastFail});a.debugArtifacts.hashes.push(o),a.debugArtifacts.initialSchema.push(c),a.debugArtifacts.intermediateFunctions.push(n),a.debugArtifacts.processedSchema.push(s.schema),a.debugArtifacts.initialCompiles.push(l),a.debugArtifacts.mangledSchema.push(p),yield $c7M9$import$_resolve(i.succeed(`${e}:${$}`))}console.log($c7M9$var$chalk_1.default.bold(\"Compile\")),yield $c7M9$import$_resolve(i.start(\"Building intermediate module\")),a.debugArtifacts.intermediateModule=$c7M9$var$templates.moduleTemplate({validatorLib:a.debugArtifacts.intermediateFunctions,defHash:$c7M9$var$XXH.h32(JSON.stringify(e.definitions),$c7M9$var$compilerheaders_1.HASH_SEED).toString(),exportHashes:a.debugArtifacts.hashes,swagger:e});const o=$c7M9$var$tmp.fileSync({prefix:\"valCI\"});$c7M9$var$fs.writeSync(o.fd,a.debugArtifacts.intermediateModule);const c=$c7M9$var$tmp.fileSync({prefix:\"valC\"}),s={js:o.name,rewrite_polyfills:!1,compilation_level:$c7M9$var$compilerheaders_1.CompilationLevel[r.compilationLevel],use_types_for_optimization:!0,preserve_type_annotations:!0,js_output_file:c.name,language_out:\"ES5_STRICT\",debug:r.debug,jscomp_off:$c7M9$var$errorSup};yield $c7M9$import$_resolve(i.succeed()),yield $c7M9$import$_resolve(i.start(\"Running Closure Compiler: \"+$c7M9$var$compilerheaders_1.CompilationLevel[r.compilationLevel]));try{yield $c7M9$import$_resolve(new Promise((e,r)=>{new $c7M9$var$ClosureCompiler(s).run(($,t,i)=>{a.debugArtifacts.closureOutput.stderr=i,a.debugArtifacts.closureOutput.stdout=t,a.debugArtifacts.closureOutput.exitCode=$,$?r(i):(a.debugArtifacts.postCompileModule=$c7M9$var$fs.readFileSync(c.name,{encoding:\"utf8\"}),e())})}))}catch(e){yield $c7M9$import$_resolve($c7M9$var$helpers_1.spinnerFail(\"Closure Compiler Failure\",e))}return yield $c7M9$import$_resolve(i.succeed()),yield $c7M9$import$_resolve(i.start(\"Final post process\")),a.module=$c7M9$var$finalProcess(a.debugArtifacts.postCompileModule),yield $c7M9$import$_resolve(i.succeed()),a});return function(r,a){return e.apply(this,arguments)}})();var $c7M9$var$__importStar=$c7M9$exports&&$c7M9$exports.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var a in e)Object.hasOwnProperty.call(e,a)&&(r[a]=e[a]);return r.default=e,r},$c7M9$var$__importDefault=$c7M9$exports&&$c7M9$exports.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($c7M9$exports,\"__esModule\",{value:!0});const $c7M9$var$lodash_1=require(\"lodash\"),$c7M9$var$swagger_parser_1=require(\"swagger-parser\"),$c7M9$var$preprocessor_1=$parcel$require(\"c7M9\",\"./preprocessor\"),$c7M9$var$method_1=$parcel$require(\"c7M9\",\"./method\"),$c7M9$var$Ajv=require(\"ajv\"),$c7M9$var$fs=$c7M9$var$__importStar(require(\"fs\")),$c7M9$var$compilerheaders_1=$parcel$require(\"c7M9\",\"./compilerheaders\"),$c7M9$var$path_1=require(\"path\"),$c7M9$var$valoryheaders_1=$parcel$require(\"c7M9\",\"../server/valoryheaders\"),$c7M9$var$Pino=require(\"pino\"),$c7M9$var$helpers_1=$parcel$require(\"c7M9\",\"../lib/helpers\"),$c7M9$var$config_1=$parcel$require(\"c7M9\",\"../lib/config\"),$c7M9$var$chalk_1=$c7M9$var$__importDefault(require(\"chalk\"));var $c7M9$export$CompileLog=$c7M9$var$Pino({prettyPrint:\"true\"===process.env[$c7M9$var$valoryheaders_1.VALORYPRETTYLOGGERVAR]});$c7M9$exports.CompileLog=$c7M9$export$CompileLog;const $c7M9$var$ClosureCompiler=require(\"google-closure-compiler\").compiler,$c7M9$var$tmp=require(\"tmp\"),$c7M9$var$dotJs=require(\"dot\");$c7M9$var$dotJs.log=!1;const $c7M9$var$templates=$c7M9$var$dotJs.process({path:$c7M9$var$path_1.join(__dirname,\"../../templates\")}),$c7M9$var$errorSup=\"undefinedVars\",$c7M9$var$XXH=require(\"xxhashjs\");var $c7M9$export$DisallowedFormats=[\"float\",\"double\",\"int32\",\"int64\",\"byte\",\"binary\"];$c7M9$exports.DisallowedFormats=$c7M9$export$DisallowedFormats;var $c7M9$export$compile=$c7M9$var$compile;function $c7M9$var$finalProcess(e){let r=e.replace(/!0/g,\" true\");return r=(r=(r=r.replace(/!1/g,\" false\")).replace(/void 0/g,\"undefined\")).replace(/([a-zA-Z]*?)=[\\S\\n\\r]*?\\\"([a-zA-Z ]+?)\\\".split\\(\\\" \\\"\\)/gm,(e,r,a)=>`${r}=${JSON.stringify(a.split(\" \"))}`)}$c7M9$exports.compile=$c7M9$export$compile;"},"hash":"78f817175ead59e5e96a53c7856fb2d9","cacheData":{"env":{},"imports":{"$c7M9$import$_coroutine":["bluebird","coroutine"],"$c7M9$import$_resolve":["bluebird","resolve"]},"exports":{"CompileLog":"$c7M9$export$CompileLog","DisallowedFormats":"$c7M9$export$DisallowedFormats","compile":"$c7M9$export$compile"},"wildcards":[],"isCommonJS":true}}