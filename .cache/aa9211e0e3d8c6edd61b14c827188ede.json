{"id":"b80R","dependencies":[{"name":"/home/john/workspace/Valory2/tsconfig.json","includedInParent":true,"mtime":1533665526367},{"name":"/home/john/workspace/Valory2/package.json","includedInParent":true,"mtime":1533666443092},{"name":"/home/john/workspace/Valory2/.babelrc","includedInParent":true,"mtime":1533664058125},{"name":"../main","loc":{"line":3,"column":23},"parent":"/home/john/workspace/Valory2/src/lib/defaultAdaptor.ts","resolved":"/home/john/workspace/Valory2/src/main.ts"}],"generated":{"js":"\"use strict\";var e=require(\"bluebird\");Object.defineProperty(exports,\"__esModule\",{value:!0});const t=require(\"../main\"),r=require(\"fastify\"),s=require(\"querystring\"),n=require(\"fast.js/string/intern\"),o=/{([\\S]*?)}/g;class a{constructor(){this.locallyRunnable=!0,this.allowDocSite=!0,this.instance=r({}),this.instance.addContentTypeParser(\"application/x-www-form-urlencoded\",{parseAs:\"string\"},d),this.instance.addContentTypeParser(\"application/json\",{parseAs:\"string\"},i)}register(r,s,a){const i=`${r}:${t.HttpMethod[s]}`;var d;r=n(r.replace(o,\":$1\")),this.instance.route({method:t.HttpMethod[s],url:r,handler:(d=(0,e.coroutine)(function*(r,s){const n=new t.ApiRequest({headers:r.req.headers,body:null,rawBody:null,formData:r.body,query:r.query,path:r.params,route:i});\"application/json\"===r.req.headers[\"content-type\"]&&null!=r.body?(n.body=r.body.parsed,n.rawBody=r.body.raw):n.body=r.body;const o=yield(0,e.resolve)(a(n));s.code(o.statusCode),s.headers(o.headers),s.send(o.body)}),function(e,t){return d.apply(this,arguments)})})}getExport(e,t){return this.instance.listen(t.port||process.env.PORT,t.host||process.env.HOST),{valory:e}}shutdown(){this.instance.server.close()}}function i(e,t,r){let s=null;try{s=JSON.parse(t)}catch(e){return e.statusCode=400,r(e,void 0)}r(null,{parsed:s,raw:t})}function d(e,t,r){r(null,s.parse(t))}exports.DefaultAdaptor=a;","map":{"mappings":[{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":0}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":13}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":17}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":19}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":27}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":39}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":46}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":61}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":69}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":82}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":83}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":72,"column":1},"generated":{"line":1,"column":90}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":94}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":100}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":102}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":1,"column":0},"generated":{"line":1,"column":110}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":121}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":123}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":4,"column":0},"generated":{"line":1,"column":131}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":142}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":144}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":5,"column":0},"generated":{"line":1,"column":152}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":6,"column":6},"generated":{"line":1,"column":167}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":6,"column":15},"generated":{"line":1,"column":169}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":6,"column":23},"generated":{"line":1,"column":177}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":7,"column":6},"generated":{"line":1,"column":202}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":7,"column":21},"generated":{"line":1,"column":204}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":9,"column":0},"generated":{"line":1,"column":218}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":9,"column":0},"generated":{"line":1,"column":224}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":13,"column":1},"generated":{"line":1,"column":226}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":10,"column":17},"generated":{"line":1,"column":240}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":10,"column":17},"generated":{"line":1,"column":245}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":10,"column":44},"generated":{"line":1,"column":262}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":11,"column":17},"generated":{"line":1,"column":264}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":11,"column":17},"generated":{"line":1,"column":269}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":11,"column":41},"generated":{"line":1,"column":283}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":12,"column":9},"generated":{"line":1,"column":285}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":12,"column":9},"generated":{"line":1,"column":290}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":12,"column":78},"generated":{"line":1,"column":299}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":12,"column":86},"generated":{"line":1,"column":301}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":7},"generated":{"line":1,"column":305}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":7},"generated":{"line":1,"column":310}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":16},"generated":{"line":1,"column":319}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":37},"generated":{"line":1,"column":340}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":74},"generated":{"line":1,"column":376}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":75},"generated":{"line":1,"column":377}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":84},"generated":{"line":1,"column":385}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":14,"column":95},"generated":{"line":1,"column":395}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":7},"generated":{"line":1,"column":398}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":7},"generated":{"line":1,"column":403}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":16},"generated":{"line":1,"column":412}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":37},"generated":{"line":1,"column":433}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":57},"generated":{"line":1,"column":452}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":58},"generated":{"line":1,"column":453}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":67},"generated":{"line":1,"column":461}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":15,"column":78},"generated":{"line":1,"column":471}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":17,"column":17},"generated":{"line":1,"column":474}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":17,"column":17},"generated":{"line":1,"column":483}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":17,"column":31},"generated":{"line":1,"column":485}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":18,"column":5},"generated":{"line":1,"column":487}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":19,"column":8},"generated":{"line":1,"column":490}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":19,"column":8},"generated":{"line":1,"column":496}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":19,"column":19},"generated":{"line":1,"column":501}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":19,"column":27},"generated":{"line":1,"column":506}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":19,"column":27},"generated":{"line":1,"column":508}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":19,"column":38},"generated":{"line":1,"column":519}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":524}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":12},"generated":{"line":1,"column":528}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":20,"column":9},"generated":{"line":1,"column":530}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":20,"column":9},"generated":{"line":1,"column":532}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":20,"column":16},"generated":{"line":1,"column":534}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":20,"column":21},"generated":{"line":1,"column":536}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":20,"column":29},"generated":{"line":1,"column":544}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":20,"column":43},"generated":{"line":1,"column":546}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":21,"column":7},"generated":{"line":1,"column":554}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":21,"column":7},"generated":{"line":1,"column":559}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":21,"column":16},"generated":{"line":1,"column":568}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":21,"column":22},"generated":{"line":1,"column":574}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":22,"column":11},"generated":{"line":1,"column":575}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":22,"column":11},"generated":{"line":1,"column":582}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":22,"column":11},"generated":{"line":1,"column":584}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":22,"column":22},"generated":{"line":1,"column":595}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":23,"column":8},"generated":{"line":1,"column":598}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":23,"column":8},"generated":{"line":1,"column":602}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":604}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":12},"generated":{"line":1,"column":613}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":12},"generated":{"line":1,"column":616}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":12},"generated":{"line":1,"column":618}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":12},"generated":{"line":1,"column":620}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":12},"generated":{"line":1,"column":631}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":19},"generated":{"line":1,"column":641}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":24},"generated":{"line":1,"column":643}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":26,"column":10},"generated":{"line":1,"column":646}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":26,"column":10},"generated":{"line":1,"column":652}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":26,"column":25},"generated":{"line":1,"column":654}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":26,"column":29},"generated":{"line":1,"column":658}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":26,"column":29},"generated":{"line":1,"column":660}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":26,"column":40},"generated":{"line":1,"column":671}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":27,"column":14},"generated":{"line":1,"column":672}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":27,"column":14},"generated":{"line":1,"column":680}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":27,"column":18},"generated":{"line":1,"column":682}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":27,"column":22},"generated":{"line":1,"column":686}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":694}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":28,"column":11},"generated":{"line":1,"column":699}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":29,"column":14},"generated":{"line":1,"column":704}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":29,"column":14},"generated":{"line":1,"column":712}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":30,"column":15},"generated":{"line":1,"column":717}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":30,"column":15},"generated":{"line":1,"column":726}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":30,"column":19},"generated":{"line":1,"column":728}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":1,"column":733}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":31,"column":12},"generated":{"line":1,"column":739}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":31,"column":16},"generated":{"line":1,"column":741}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":32,"column":11},"generated":{"line":1,"column":747}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":32,"column":11},"generated":{"line":1,"column":752}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":32,"column":15},"generated":{"line":1,"column":754}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":33,"column":5},"generated":{"line":1,"column":761}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":33,"column":5},"generated":{"line":1,"column":767}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":44},"generated":{"line":1,"column":771}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":8},"generated":{"line":1,"column":792}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":12},"generated":{"line":1,"column":794}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":16},"generated":{"line":1,"column":798}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":24},"generated":{"line":1,"column":806}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":78},"generated":{"line":1,"column":823}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":66},"generated":{"line":1,"column":829}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":35,"column":70},"generated":{"line":1,"column":831}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":36,"column":18},"generated":{"line":1,"column":837}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":36,"column":18},"generated":{"line":1,"column":839}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":36,"column":25},"generated":{"line":1,"column":844}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":36,"column":29},"generated":{"line":1,"column":846}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":36,"column":34},"generated":{"line":1,"column":851}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":37,"column":18},"generated":{"line":1,"column":858}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":37,"column":18},"generated":{"line":1,"column":860}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":37,"column":28},"generated":{"line":1,"column":868}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":37,"column":32},"generated":{"line":1,"column":870}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":37,"column":37},"generated":{"line":1,"column":875}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":39,"column":18},"generated":{"line":1,"column":880}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":39,"column":18},"generated":{"line":1,"column":882}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":39,"column":25},"generated":{"line":1,"column":887}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":39,"column":29},"generated":{"line":1,"column":889}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":10},"generated":{"line":1,"column":894}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":10},"generated":{"line":1,"column":900}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":27},"generated":{"line":1,"column":908}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":27},"generated":{"line":1,"column":910}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":27},"generated":{"line":1,"column":912}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":27},"generated":{"line":1,"column":921}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":41,"column":35},"generated":{"line":1,"column":923}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":42,"column":8},"generated":{"line":1,"column":927}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":42,"column":8},"generated":{"line":1,"column":929}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":42,"column":13},"generated":{"line":1,"column":934}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":42,"column":22},"generated":{"line":1,"column":936}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":43,"column":17},"generated":{"line":1,"column":948}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":43,"column":17},"generated":{"line":1,"column":950}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":43,"column":25},"generated":{"line":1,"column":958}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":43,"column":34},"generated":{"line":1,"column":960}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":1,"column":969}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":44,"column":8},"generated":{"line":1,"column":971}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":44,"column":13},"generated":{"line":1,"column":976}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":44,"column":22},"generated":{"line":1,"column":978}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":986}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":995}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":997}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":1000}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":1007}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":1009}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":1015}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":24,"column":3},"generated":{"line":1,"column":1020}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":49,"column":18},"generated":{"line":1,"column":1035}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":49,"column":18},"generated":{"line":1,"column":1045}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":49,"column":44},"generated":{"line":1,"column":1047}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":51,"column":9},"generated":{"line":1,"column":1050}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":7},"generated":{"line":1,"column":1057}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":7},"generated":{"line":1,"column":1062}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":16},"generated":{"line":1,"column":1071}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":23},"generated":{"line":1,"column":1078}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":31},"generated":{"line":1,"column":1080}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":39},"generated":{"line":1,"column":1086}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":47},"generated":{"line":1,"column":1094}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":51},"generated":{"line":1,"column":1098}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":57},"generated":{"line":1,"column":1103}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":65},"generated":{"line":1,"column":1105}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":73},"generated":{"line":1,"column":1111}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":81},"generated":{"line":1,"column":1119}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":50,"column":85},"generated":{"line":1,"column":1123}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":51,"column":9},"generated":{"line":1,"column":1129}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":51,"column":10},"generated":{"line":1,"column":1130}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":51,"column":18},"generated":{"line":1,"column":1137}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":54,"column":16},"generated":{"line":1,"column":1140}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":55,"column":7},"generated":{"line":1,"column":1151}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":55,"column":7},"generated":{"line":1,"column":1156}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":55,"column":16},"generated":{"line":1,"column":1165}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":55,"column":23},"generated":{"line":1,"column":1172}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":59,"column":0},"generated":{"line":1,"column":1181}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":59,"column":0},"generated":{"line":1,"column":1190}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":59,"column":20},"generated":{"line":1,"column":1192}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":59,"column":42},"generated":{"line":1,"column":1194}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":59,"column":56},"generated":{"line":1,"column":1196}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":60,"column":5},"generated":{"line":1,"column":1199}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":60,"column":5},"generated":{"line":1,"column":1203}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":60,"column":12},"generated":{"line":1,"column":1205}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":61,"column":5},"generated":{"line":1,"column":1210}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":62,"column":9},"generated":{"line":1,"column":1214}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":62,"column":9},"generated":{"line":1,"column":1216}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":62,"column":14},"generated":{"line":1,"column":1221}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":62,"column":20},"generated":{"line":1,"column":1227}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":63,"column":3},"generated":{"line":1,"column":1230}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":63,"column":10},"generated":{"line":1,"column":1236}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":65,"column":9},"generated":{"line":1,"column":1239}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":64,"column":6},"generated":{"line":1,"column":1246}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":64,"column":6},"generated":{"line":1,"column":1248}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":64,"column":19},"generated":{"line":1,"column":1259}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":65,"column":9},"generated":{"line":1,"column":1263}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":65,"column":14},"generated":{"line":1,"column":1265}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":65,"column":19},"generated":{"line":1,"column":1272}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":6},"generated":{"line":1,"column":1275}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":6},"generated":{"line":1,"column":1277}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":12},"generated":{"line":1,"column":1282}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":13},"generated":{"line":1,"column":1283}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":21},"generated":{"line":1,"column":1290}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":27},"generated":{"line":1,"column":1292}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":67,"column":32},"generated":{"line":1,"column":1296}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":1,"column":1300}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":70,"column":0},"generated":{"line":1,"column":1309}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":70,"column":20},"generated":{"line":1,"column":1311}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":70,"column":42},"generated":{"line":1,"column":1313}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":70,"column":56},"generated":{"line":1,"column":1315}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":71,"column":6},"generated":{"line":1,"column":1318}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":71,"column":6},"generated":{"line":1,"column":1320}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":71,"column":12},"generated":{"line":1,"column":1325}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":71,"column":12},"generated":{"line":1,"column":1327}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":71,"column":18},"generated":{"line":1,"column":1333}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":9,"column":0},"generated":{"line":1,"column":1337}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":9,"column":0},"generated":{"line":1,"column":1345}},{"source":"lib/defaultAdaptor.ts","name":null,"original":{"line":9,"column":0},"generated":{"line":1,"column":1360}}],"sources":{"lib/defaultAdaptor.ts":"import {ApiExchange, ApiResponse, ApiServer, HttpMethod, ValoryMetadata, ApiRequest} from \"../main\";\nimport {FastifyInstance, HTTPMethod } from \"fastify\";\nimport {IncomingMessage, ServerResponse, Server} from \"http\";\nimport fastify = require(\"fastify\");\nimport {parse} from \"querystring\";\nconst intern = require(\"fast.js/string/intern\");\nconst pathReplacer = /{([\\S]*?)}/g;\n\nexport class DefaultAdaptor implements ApiServer {\n\tpublic readonly locallyRunnable: boolean = true;\n\tpublic readonly allowDocSite: boolean = true;\n\tprivate instance: FastifyInstance<Server, IncomingMessage, ServerResponse> = fastify({});\n\tconstructor() {\n\t\tthis.instance.addContentTypeParser(\"application/x-www-form-urlencoded\", {parseAs: \"string\"}, formParser as any);\n\t\tthis.instance.addContentTypeParser(\"application/json\", {parseAs: \"string\"}, jsonParser as any);\n\t}\n\tpublic register(path: string, method: HttpMethod,\n\t\t\t\t\thandler: (request: ApiRequest) => ApiResponse | Promise<ApiResponse>) {\n\t\tconst route = `${path}:${HttpMethod[method]}`;\n\t\tpath = intern(path.replace(pathReplacer, \":$1\"));\n\t\tthis.instance.route({\n\t\t\tmethod: HttpMethod[method] as HTTPMethod,\n\t\t\turl: path,\n\t\t\thandler: async (req, res) => {\n\t\t\t\t// FIXME: setting both formData and body is lazy, need a better solution\n\t\t\t\tconst transRequest = new ApiRequest({\n\t\t\t\t\theaders: req.req.headers as {[key: string]: any},\n\t\t\t\t\tbody: null,\n\t\t\t\t\trawBody: null,\n\t\t\t\t\tformData: req.body,\n\t\t\t\t\tquery: req.query,\n\t\t\t\t\tpath: req.params,\n\t\t\t\t\troute,\n\t\t\t\t});\n\t\t\t\tif (req.req.headers[\"content-type\"] === \"application/json\" && req.body != null) {\n\t\t\t\t\ttransRequest.body = req.body.parsed;\n\t\t\t\t\ttransRequest.rawBody = req.body.raw;\n\t\t\t\t} else {\n\t\t\t\t\ttransRequest.body = req.body;\n\t\t\t\t}\n\t\t\t\tconst response = await handler(transRequest);\n\t\t\t\tres.code(response.statusCode);\n\t\t\t\t(res as any).headers(response.headers);\n\t\t\t\tres.send(response.body);\n\t\t\t},\n\t\t});\n\t}\n\n\tpublic getExport(metadata: ValoryMetadata, options: any): {valory: ValoryMetadata} {\n\t\tthis.instance.listen(options.port || process.env.PORT, options.host || process.env.HOST);\n\t\treturn {valory: metadata};\n\t}\n\n\tpublic shutdown() {\n\t\tthis.instance.server.close();\n\t}\n}\n\nfunction jsonParser(req: IncomingMessage, body: string, done: (err?: Error, body?: any) => void) {\n\tlet json = null;\n\ttry {\n\t\tjson = JSON.parse(body);\n\t} catch (err) {\n\t\terr.statusCode = 400;\n\t\treturn done(err, undefined);\n\t}\n\tdone(null, {parsed: json, raw: body});\n}\n\nfunction formParser(req: IncomingMessage, body: string, done: (err?: Error, body?: any) => void) {\n\tdone(null, parse(body));\n}\n"},"lineCount":null}},"hash":"34e926e2788f10f4cc878c03c386cb29","cacheData":{"env":{}}}