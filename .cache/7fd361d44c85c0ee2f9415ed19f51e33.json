{"id":"b80R","dependencies":[{"name":"/home/john/workspace/Valory2/tsconfig.json","includedInParent":true,"mtime":1531152310742},{"name":"/home/john/workspace/Valory2/package.json","includedInParent":true,"mtime":1533664046105},{"name":"/home/john/workspace/Valory2/.babelrc","includedInParent":true,"mtime":1533664058125},{"name":"../main","loc":{"line":3,"column":23},"parent":"/home/john/workspace/Valory2/src/lib/defaultAdaptor.ts","resolved":"/home/john/workspace/Valory2/src/main.ts"}],"generated":{"js":"var $b80R$exports={};$parcel$require(\"b80R\",\"bluebird\"),$parcel$require(\"b80R\",\"bluebird\"),Object.defineProperty($b80R$exports,\"__esModule\",{value:!0});const $b80R$var$main_1=$parcel$require(\"b80R\",\"../main\"),$b80R$var$fastify=require(\"fastify\"),$b80R$var$querystring_1=require(\"querystring\"),$b80R$var$intern=require(\"fast.js/string/intern\"),$b80R$var$pathReplacer=/{([\\S]*?)}/g;class $b80R$var$DefaultAdaptor{constructor(){this.locallyRunnable=!0,this.allowDocSite=!0,this.instance=$b80R$var$fastify({}),this.instance.addContentTypeParser(\"application/x-www-form-urlencoded\",{parseAs:\"string\"},$b80R$var$formParser),this.instance.addContentTypeParser(\"application/json\",{parseAs:\"string\"},$b80R$var$jsonParser)}register(r,e,t){const a=`${r}:${$b80R$var$main_1.HttpMethod[e]}`;var $;r=$b80R$var$intern(r.replace($b80R$var$pathReplacer,\":$1\")),this.instance.route({method:$b80R$var$main_1.HttpMethod[e],url:r,handler:($=$b80R$import$_coroutine(function*(r,e){const $=new $b80R$var$main_1.ApiRequest({headers:r.req.headers,body:null,rawBody:null,formData:r.body,query:r.query,path:r.params,route:a});\"application/json\"===r.req.headers[\"content-type\"]&&null!=r.body?($.body=r.body.parsed,$.rawBody=r.body.raw):$.body=r.body;const s=yield $b80R$import$_resolve(t($));e.code(s.statusCode),e.headers(s.headers),e.send(s.body)}),function(r,e){return $.apply(this,arguments)})})}getExport(r,e){return this.instance.listen(e.port||process.env.PORT,e.host||process.env.HOST),{valory:r}}shutdown(){this.instance.server.close()}}var $b80R$export$DefaultAdaptor=$b80R$var$DefaultAdaptor;function $b80R$var$jsonParser(r,e,t){let a=null;try{a=JSON.parse(e)}catch(r){return r.statusCode=400,t(r,void 0)}t(null,{parsed:a,raw:e})}function $b80R$var$formParser(r,e,t){t(null,$b80R$var$querystring_1.parse(e))}$b80R$exports.DefaultAdaptor=$b80R$export$DefaultAdaptor;"},"hash":"1591394a0945f0a8e217eb03c60bee76","cacheData":{"env":{},"imports":{"$b80R$import$_coroutine":["bluebird","coroutine"],"$b80R$import$_resolve":["bluebird","resolve"]},"exports":{"DefaultAdaptor":"$b80R$export$DefaultAdaptor"},"wildcards":[],"isCommonJS":true}}