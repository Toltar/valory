#!/usr/bin/env node
parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"Y6jv":[function(require,module,exports) {
"use strict";var e=require("bluebird");let r=(()=>{var r=(0,e.coroutine)(function*(r,n){yield(0,e.resolve)(i.Config.Spinner.fail(o.default.red.bold(r+"\n"))),t.ThreadSpinner.shutdown(),console.error(n),process.exit(1)});return function(e,n){return r.apply(this,arguments)}})();var n=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("thread-spin"),o=n(require("chalk")),i=require("./config"),u=1e3,s=1e6;function l(...e){const r=arguments.length,n=[];let t,o,i,u;for(t=0;t<r;t++)if(o=arguments[t],Array.isArray(o))for(i=o.length,u=0;u<i;u++)n.push(o[u]);else n.push(o);return n}function c(e,r,n){const t=e.length,o=void 0!==n?a(r,n):r;let i;for(i=0;i<t;i++)o(e[i],i,e)}function a(e,r){return(n,t,o)=>e.call(r,n,t,o)}function f(e){return e[0]*u+e[1]/s}exports.fastConcat=l,exports.fastForEach=c,exports.bindInternal3=a,exports.convertTime=f,exports.spinnerFail=r;
},{"./config":"0Kt0"}],"EHrm":[function(require,module,exports) {
module.exports={name:"valory",version:"2.6.0",description:"A server agnostic web framework for creating bulletproof apis",typings:"types/main.d.ts",main:"pkg/main.js",scripts:{pretest:"npm run build",test:"mocha dist/test/test.js",build:"tsc",release:"semantic-release",commitmsg:"commitlint -e $GIT_PARAMS",lint:"tslint --project .",docgen:"typedoc --module commonjs --excludePrivate --out docs --excludeNotExported --ignoreCompilerErrors --mode file src/server"},engines:{node:">=8"},author:"John Conley",license:"ISC",files:["package.json","README.md","html","templates","tsconfig.json","tslint.json","tsfmt.json","pkg","types"],devDependencies:{"@commitlint/cli":"^7.0.0","@commitlint/config-conventional":"^7.0.1","@types/bluebird-global":"^3.5.6","@types/chai":"^4.1.0","@types/inquirer":"^0.0.42","@types/lodash":"^4.14.112","@types/minimatch":"^3.0.3","@types/mocha":"^5.2.5","@types/node":"^10.5.2","@types/pino":"^4.7.0","@types/request":"^2.47.0","@types/request-promise":"^4.1.42","@types/semver":"^5.5.0","@types/steed":"^1.1.2","@types/swagger-parser":"^4.0.2","@types/yargs":"^11.1.0","babel-core":"^6.26.3","babel-plugin-loop-optimizer":"^1.4.1","babel-plugin-transform-async-to-bluebird":"^1.1.1",chai:"^4.1.2","cz-conventional-changelog":"^2.1.0","fast-async":"^6.3.7",husky:"^0.14.3",mocha:"5.0.5","mocha-typescript":"1.1.12",request:"^2.83.0","request-promise":"^4.2.2","semantic-release":"^15.8.1",typedoc:"^0.11.1"},dependencies:{ajv:"^6.5.2",bluebird:"^3.5.1",chalk:"^2.4.1",dot:"^1.1.2","fast.js":"^0.1.1",fastify:"^1.8.0","google-closure-compiler":"^20180716.0.1",hyperid:"^1.2.0",inquirer:"^6.0.0","js-beautify":"^1.7.5","json-schema-merge-allof":"^0.6.0",lodash:"^4.17.4","lodash-deep":"^2.0.0","map-keys-deep-lodash":"^1.0.1",minimatch:"^3.0.4",moment:"^2.22.2",pino:"^4.10.3",semver:"^5.5.0",steed:"^1.1.3","swagger-parser":"^5.0.0","thread-spin":"^1.2.0",tmp:"^0.0.33","ts-node":"^7.0.0",tstl:"^2.0.2",typescript:"^2.9.2",xxhashjs:"^0.2.2",yargs:"^12.0.1"},bin:{valory:"pkg/lib/cli.js"},release:{repositoryUrl:"https://git-codecommit.us-east-1.amazonaws.com/v1/repos/Valory2",branch:"master",verifyConditions:["@semantic-release/npm"],publish:["@semantic-release/npm"],success:[],fail:[]},config:{commitizen:{path:"./node_modules/cz-conventional-changelog"}},publishConfig:{registry:"https://registry.npmjs.org"}};
},{}],"0Kt0":[function(require,module,exports) {
"use strict";var e=require("bluebird"),o=function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(o[r]=e[r]);return o.default=e,o},r=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=o(require("path")),n=require("fs"),a=require("thread-spin"),i=require("semver"),s=require("child_process"),l=r(require("chalk")),c=require("./helpers");var u;exports.CLI_MODE_FLAG="VALORY_CLI",exports.VALORY_ROOT="VALORY_ROOT",function(o){let r=(u=(0,e.coroutine)(function*(){const r=/version \"([A-Za-z0-9\_\.]*?)\"/g;console.log(l.default.bold("Requirements")),yield(0,e.resolve)(o.Spinner.start("Node 8+")),i.gt(i.coerce(process.version),"8.0.0")||(yield(0,e.resolve)(c.spinnerFail("Node version too low",null))),yield(0,e.resolve)(o.Spinner.succeed(l.default.green(`Node ${process.version}`))),yield(0,e.resolve)(o.Spinner.start("Java 1.7+"));try{const t=s.spawnSync("java",["-version"]).stderr,n=r.exec(t.toString())[1];i.gt(i.coerce(n),i.coerce("1.7"))||(yield(0,e.resolve)(c.spinnerFail("Java version too low",null))),yield(0,e.resolve)(o.Spinner.succeed(l.default.green(`Java ${n}`)))}catch(o){yield(0,e.resolve)(c.spinnerFail("Java installation missing or broken",o))}console.log("")}),function(){return u.apply(this,arguments)});var u;o.CONFIG_FILE="valory.json",o.SWAGGER_FILE="swagger.json",o.COMPILED_SWAGGER_FILE=".compswag.js",o.GENERATED_ROUTES_FILE="generatedRoutes.ts",o.COMPILED_ROUTES_FILE="generatedRoutes.js",o.RootPath="",o.CompilerMode=!1,o.Loaded=!1,o.ConfigPath="",o.SwaggerPath="",o.CompSwagPath="",o.PackageJSON=null,o.ValoryVersion="",o.GeneratedRoutePath="",o.SourceRoutePath="",o.PackageJSONPath="",o.load=function(e=!0,r){if(o.Loaded)return;o.CompilerMode="TRUE"===process.env.VALORYCOMPILER,o.Loaded=!0;const i=process.env[exports.VALORY_ROOT];if(r=null!=i?i:r||__dirname.split("node_modules")[0],o.RootPath=r,process.env[exports.VALORY_ROOT]=o.RootPath,o.ConfigPath=`${o.RootPath}/${o.CONFIG_FILE}`,o.SwaggerPath=`${o.RootPath}/${o.SWAGGER_FILE}`,o.CompSwagPath=`${o.RootPath}/${o.COMPILED_SWAGGER_FILE}`,o.PackageJSONPath=`${o.RootPath}/package.json`,o.CompilerMode&&(o.Spinner=new a.ThreadSpinner(void 0,"test"===process.env.NODE_ENV),o.ValoryVersion=require("../../package.json").version,o.PackageJSON=require(o.PackageJSONPath)),e){try{o.ConfigData=JSON.parse(n.readFileSync(o.ConfigPath,{encoding:"utf8"}))}catch(e){throw Error("Valory config is missing from: "+o.ConfigPath)}o.ConfigData.entrypoint=t.resolve(t.join(o.RootPath),o.ConfigData.entrypoint),o.GeneratedRoutePath=`${t.resolve(t.dirname(o.ConfigData.entrypoint))}/${o.COMPILED_ROUTES_FILE}`,o.ConfigData.sourceEntrypoint&&(o.ConfigData.sourceEntrypoint=t.resolve(t.join(o.RootPath),o.ConfigData.sourceEntrypoint),o.SourceRoutePath=`${t.resolve(t.dirname(o.ConfigData.sourceEntrypoint))}/${o.GENERATED_ROUTES_FILE}`)}},o.checkRequirements=r}(u=exports.Config||(exports.Config={}));
},{"./helpers":"Y6jv","../../package.json":"EHrm"}],"7BEu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../main");class e{constructor(){this.statusCode=200,this.headers={}}setStatus(t){this.statusCode=t}getStatus(){return this.statusCode}setHeader(t,e){this.headers[t]=e}getHeader(t){return this.headers[t]}getHeaders(){return this.headers}clearStatus(){this.statusCode=200}clearHeaders(){this.headers={}}buildError(e,s){const r=t.Valory.getInstance().buildError(e,s);return this.setStatus(r.statusCode),r.body}}exports.Controller=e;
},{"../main":"ZCfc"}],"b80R":[function(require,module,exports) {
"use strict";var e=require("bluebird");Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../main"),r=require("fastify"),s=require("querystring"),n=require("fast.js/string/intern"),o=/{([\S]*?)}/g;class a{constructor(){this.locallyRunnable=!0,this.allowDocSite=!0,this.instance=r({}),this.instance.addContentTypeParser("application/x-www-form-urlencoded",{parseAs:"string"},d),this.instance.addContentTypeParser("application/json",{parseAs:"string"},i)}register(r,s,a){const i=`${r}:${t.HttpMethod[s]}`;var d;r=n(r.replace(o,":$1")),this.instance.route({method:t.HttpMethod[s],url:r,handler:(d=(0,e.coroutine)(function*(r,s){const n=new t.ApiRequest({headers:r.req.headers,body:null,rawBody:null,formData:r.body,query:r.query,path:r.params,route:i});"application/json"===r.req.headers["content-type"]&&null!=r.body?(n.body=r.body.parsed,n.rawBody=r.body.raw):n.body=r.body;const o=yield(0,e.resolve)(a(n));s.code(o.statusCode),s.headers(o.headers),s.send(o.body)}),function(e,t){return d.apply(this,arguments)})})}getExport(e,t){return this.instance.listen(t.port||process.env.PORT,t.host||process.env.HOST),{valory:e}}shutdown(){this.instance.server.close()}}function i(e,t,r){let s=null;try{s=JSON.parse(t)}catch(e){return e.statusCode=400,r(e,void 0)}r(null,{parsed:s,raw:t})}function d(e,t,r){r(null,s.parse(t))}exports.DefaultAdaptor=a;
},{"../main":"ZCfc"}],"FAPY":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.HASH_SEED=3141997,function(e){e[e.ADVANCED=0]="ADVANCED",e[e.WHITESPACE_ONLY=1]="WHITESPACE_ONLY",e[e.SIMPLE=2]="SIMPLE"}(e=exports.CompilationLevel||(exports.CompilationLevel={})),exports.FUNCTION_PREFIX="f";
},{}],"kMMG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./compilerheaders"),r=require("../lib/config"),o=require("xxhashjs");function i(i){const t=require(r.Config.CompSwagPath);if(o.h32(JSON.stringify(i),e.HASH_SEED).toString()!==t.defHash)throw Error("Compiled swagger is out of date. Please run valory CLI.");return t}exports.loadModule=i;
},{"./compilerheaders":"FAPY","../lib/config":"0Kt0"}],"8v88":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("hyperid")();class e{constructor(t){this.attachments={},this.headers=t.headers,this.body=t.body,this.rawBody=t.rawBody,this.formData=t.formData,this.query=t.query,this.route=t.route,this.path=t.path}static createKey(){return{id:t(),marker:0}}putAttachment(t,e){if(null!=this.attachments[t.id])throw Error("Refusing to clobber existing attachment");this.attachments[t.id]=e}getAttachment(t){return this.attachments[t.id]}}exports.ApiRequest=e;
},{}],"Urm3":[function(require,module,exports) {
"use strict";var E;Object.defineProperty(exports,"__esModule",{value:!0}),exports.VALORYLOGGERVAR="LOGLEVEL",exports.VALORYPRETTYLOGGERVAR="PRETTYLOG",exports.VALORYMETAVAR="VALORY_METATDATA",function(E){E[E.POST=0]="POST",E[E.PUT=1]="PUT",E[E.GET=2]="GET",E[E.DELETE=3]="DELETE",E[E.HEAD=4]="HEAD",E[E.PATCH=5]="PATCH"}(E=exports.HttpMethod||(exports.HttpMethod={}));
},{}],"9tIP":[function(require,module,exports) {
"use strict";var e=require("bluebird");Object.defineProperty(exports,"__esModule",{value:!0}),global.Promise=require("bluebird");const t=require("lodash"),r=require("../compiler/loader"),s=require("fs"),i=require("./request"),o=require("../lib/config"),n=require("../lib/defaultAdaptor"),a=require("./valoryheaders"),d=require("pino"),l=require("path"),u=require("steed")(),h=require("hyperid")(),c="|Status Code|Name|Description|\n|-|-|--|\n",p="../../html/index.html",g=(e,t)=>({statusCode:e.statusCode,body:{code:e.errorCode,message:null!=t?t:e.defaultMessage},headers:{"Content-Type":"application/json"}}),f={ValidationError:{statusCode:200,errorCode:1001,defaultMessage:"Invalid Parameters"},TokenMalformed:{statusCode:200,errorCode:1002,defaultMessage:"Authorization Failure"},InternalError:{statusCode:200,errorCode:1003,defaultMessage:"An internal error occured"}};class E{constructor(e,t,s=[],i=[],l,u,h,c,p={},y={}){if(this.server=h,this.Logger=d({level:process.env[a.VALORYLOGGERVAR]||"info",prettyPrint:"true"===process.env[a.VALORYPRETTYLOGGERVAR]}),this.COMPILERMODE="TRUE"===process.env.VALORYCOMPILER,this.TESTMODE="TRUE"===process.env.TEST_MODE,this.errorFormatter=g,this.globalMiddleware=[],this.globalPostMiddleware=[],this.errors=f,this.metadata={undocumentedEndpoints:[],valoryPath:__dirname,compiledSwaggerPath:o.Config.CompSwagPath,swagger:null},o.Config.load(),null!=E.instance)throw Error("Only a single valory instance is allowed");if(E.directInstantiation)throw Error("Direct instantiation of valory is not allowed");if(E.instance=this,this.apiDef={swagger:"2.0",info:e,paths:{},definitions:l,tags:u,consumes:s,produces:i,parameters:p,responses:y},null!=c&&(this.Logger.debug("Path prefix set:",c),this.apiDef.basePath=c),Object.assign(this.errors,t),this.COMPILERMODE){if(this.Logger.debug("Starting in compiler mode"),this.apiDef.tags.push(m(this.errors)),""!==o.Config.SourceRoutePath){const e=require(o.Config.SourceRoutePath);Object.assign(this.apiDef.definitions,e.definitions),this.registerGeneratedRoutes=e.register}}else{if(this.Logger.info("Starting valory"),this.TESTMODE&&(this.server=new n.DefaultAdaptor),""!==o.Config.SourceRoutePath){const e=require(o.Config.GeneratedRoutePath);Object.assign(this.apiDef.definitions,e.definitions),this.registerGeneratedRoutes=e.register}this.validatorModule=r.loadModule(l),this.server.allowDocSite&&this.registerDocSite()}}static createInstance(e){return E.directInstantiation=!1,new E(e.info,e.errors||{},e.consumes,e.produces,e.definitions||{},e.tags||[],e.server,e.basePath,e.parameters,e.responses)}static getInstance(){if(null==E.instance)throw Error("Valory instance has not yet been created");return E.instance}endpoint(e,t,r,s,i=[],o=!0,n=[]){const d=a.HttpMethod[t].toLowerCase();this.Logger.debug(`Registering endpoint ${this.apiDef.basePath||""}${e}:${d}`),this.COMPILERMODE?this.endpointCompile(e,t,r,s,d,i,o,n):this.endpointRun(e,t,r,s,d,i,o,n)}setErrorFormatter(e){this.errorFormatter=e}buildError(e,t){const r="string"==typeof e?this.errors[e]:e;if(null==r)throw Error(`Error definition "${e}" does not exist`);return this.errorFormatter(r,t)}buildSuccess(e,t={}){return null==t["Content-Type"]&&("object"==typeof e?t["Content-Type"]="application/json":"string"==typeof e&&(t["Content-Type"]="text/plain")),{body:e,headers:t,statusCode:200}}get(e,t,r,s=[],i=!0,o=[]){this.endpoint(e,a.HttpMethod.GET,t,r,s,i,o)}post(e,t,r,s=[],i=!0,o=[]){this.endpoint(e,a.HttpMethod.POST,t,r,s,i,o)}delete(e,t,r,s=[],i=!0,o=[]){this.endpoint(e,a.HttpMethod.DELETE,t,r,s,i,o)}head(e,t,r,s=[],i=!0,o=[]){this.endpoint(e,a.HttpMethod.HEAD,t,r,s,i,o)}patch(e,t,r,s=[],i=!0,o=[]){this.endpoint(e,a.HttpMethod.PATCH,t,r,s,i,o)}put(e,t,r,s=[],i=!0,o=[]){this.endpoint(e,a.HttpMethod.PUT,t,r,s,i,o)}addGlobalMiddleware(e){this.Logger.debug("Adding global middleware:",e.name),this.globalMiddleware.push(e)}addGlobalPostMiddleware(e){this.Logger.debug("Adding global post middleware:",e.name),this.globalPostMiddleware.push(e)}start(e){null!=this.registerGeneratedRoutes&&this.registerGeneratedRoutes(this),this.metadata.swagger=this.apiDef;const t=this.server.getExport(this.metadata,e);return this.COMPILERMODE&&(process.env[a.VALORYMETAVAR]=JSON.stringify(t)),this.COMPILERMODE||this.Logger.info("Valory startup complete"),t}shutdown(){this.server.shutdown()}endpointCompile(e,r,s,i,o,n=[],a=!0,d=[]){a||this.metadata.undocumentedEndpoints.push(e);const l=this.globalMiddleware.concat(n,this.globalPostMiddleware,d);for(const e of l)if(null!=e.tag){e.tag instanceof Array||(e.tag=[e.tag]);for(const t of e.tag){let e="";"string"==typeof t?e=t:(this.apiDef.tags.push(t),e=t.name),null==s.tags?s.tags=[e]:s.tags.push(e)}}s.tags=t.uniq(s.tags),this.apiDef.tags=t.uniq(this.apiDef.tags),t.set(this.apiDef.paths,`${e}.${o}`,s)}endpointRun(t,r,s,i,o,n=[],a=!0,d=[]){var l=this;const u=this.validatorModule.getValidator(t,o);if(null!=this.apiDef.basePath&&(t=this.apiDef.basePath+t),null==u)throw Error("Compiled swagger is out of date. Please run valory cli");const c=`${t}:${o}`,p=this.Logger.child({endpoint:c}),g=this.globalMiddleware.concat(n),f=this.globalPostMiddleware.concat(d),m=p.chindings,b=(M=(0,e.coroutine)(function*(t){const r=h();t.putAttachment(E.RequestIDKey,r),p.chindings=`${m},"requestId":"${r}"`,p.debug(t,"Received request");try{const s=yield(0,e.resolve)(y(g,t,p));if(null!=s)return s;const o=u(t);let n;if(!0!==o)n=l.buildError("ValidationError",o);else try{n=yield(0,e.resolve)(i(t,p,{requestId:r}))}catch(e){"ValoryEndpointError"===e.name?n=l.buildError(e.valoryErrorCode,e.message||void 0):(p.error("Internal exception occurred while processing request"),p.error(e),n=l.buildError("InternalError"))}t.putAttachment(E.ValidationResultKey,o),t.putAttachment(E.ResponseKey,n);const a=yield(0,e.resolve)(y(f,t,p));return null!=a?a:n}catch(e){return"ValoryEndpointError"===e.name?l.buildError(e.valoryErrorCode,e.message||void 0):(p.error("Internal exception occurred while processing request"),p.error(e),l.buildError("InternalError"))}}),function(e){return M.apply(this,arguments)});var M;this.server.register(t,r,b)}registerDocSite(){const e=this.apiDef.basePath||"";let t;const r=this.validatorModule.swaggerBlob;this.server.register(e+"/swagger.json",a.HttpMethod.GET,e=>({body:r,headers:{"Content-Type":"text/plain"},query:null,path:null,statusCode:200,formData:null})),this.server.register(""!==e?e:"/",a.HttpMethod.GET,e=>(t||(t=s.readFileSync(l.join(__dirname,p),{encoding:"utf8"})),{body:t,headers:{"Content-Type":"text/html"},query:null,path:null,statusCode:200,formData:null}))}}function y(e,t,r){return new Promise(s=>{let i=null;u.eachSeries(e,(e,s)=>{const o=r.child({middleware:e.name});o.debug("Running Middleware"),e.handler(t,o,e=>{if(null!=e)return i=e,void s(e);s()})},e=>{s(i)})})}function m(e){const r={name:"Errors",description:"",externalDocs:null};let s=c;const i=Object.keys(e);i.sort((t,r)=>{const s=e[t].errorCode,i=e[r].errorCode;return s<i?-1:s===i?0:s>i?1:void 0});for(const t of i){const r=e[t];s+="|"+r.errorCode+"|"+t+"|"+r.defaultMessage+"|\n"}return r.description=s,t.omitBy(r,t.isNil)}E.ValidationResultKey=i.ApiRequest.createKey(),E.RequestIDKey=i.ApiRequest.createKey(),E.ResponseKey=i.ApiRequest.createKey(),E.directInstantiation=!0,exports.Valory=E;
},{"../compiler/loader":"kMMG","./request":"8v88","../lib/config":"0Kt0","../lib/defaultAdaptor":"b80R","./valoryheaders":"Urm3"}],"Y6vY":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});
},{}],"D7a/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const r=(r,e)=>({valoryErrorCode:r,message:e,name:"ValoryEndpointError"});exports.ApiError=r;
},{}],"g1Xp":[function(require,module,exports) {
"use strict";function e(e){return()=>{}}function t(e){return()=>{}}function r(e){return()=>{}}function n(e){return()=>{}}function o(e){return()=>{}}function u(e){return(t,r)=>{null==(t=null!=r?t[r]:t.prototype).middleware&&(t.middleware=[]),t.middleware.push(e)}}function s(e){return(t,r)=>{null==(t=null!=r?t[r]:t.prototype).postMiddleware&&(t.postMiddleware=[]),t.postMiddleware.push(e)}}function p(){return()=>{}}function i(e){return()=>{}}function c(){return()=>{}}function d(e){return()=>{}}function f(e){return()=>{}}function x(e){return()=>{}}function l(){return()=>{}}function a(e,t){return()=>{}}function w(e,t,r){return()=>{}}function P(e){return e=>{}}function y(){return()=>{}}function M(...e){return()=>{}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Get=e,exports.Post=t,exports.Put=r,exports.Patch=n,exports.Delete=o,exports.Middleware=u,exports.PostMiddleware=s,exports.Body=p,exports.BodyProp=i,exports.Request=c,exports.Path=d,exports.Query=f,exports.Header=x,exports.Logger=l,exports.SuccessResponse=a,exports.Response=w,exports.Route=P,exports.Hidden=y,exports.Tags=M;
},{}],"ZCfc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./server/controller");exports.Controller=e.Controller;var r=require("./lib/defaultAdaptor");exports.DefaultAdaptor=r.DefaultAdaptor;var t=require("./server/valory");exports.Valory=t.Valory,exports.ValoryOptions=t.ValoryOptions;var o=require("./server/request");exports.ApiRequest=o.ApiRequest,exports.AttachmentKey=o.AttachmentKey,exports.ApiRequestOptions=o.ApiRequestOptions;var s=require("./server/swagger");exports.Swagger=s.Swagger;var p=require("./server/apiError");exports.ApiError=p.ApiError;var a=require("./server/decorators");exports.Logger=a.Logger,exports.PostMiddleware=a.PostMiddleware,exports.Middleware=a.Middleware,exports.Body=a.Body,exports.BodyProp=a.BodyProp,exports.Delete=a.Delete,exports.Get=a.Get,exports.Header=a.Header,exports.Hidden=a.Hidden,exports.Patch=a.Patch,exports.Path=a.Path,exports.Post=a.Post,exports.Put=a.Put,exports.Query=a.Query,exports.Request=a.Request,exports.Response=a.Response,exports.Route=a.Route,exports.SuccessResponse=a.SuccessResponse,exports.Tags=a.Tags;var x=require("./server/valoryheaders");exports.HttpMethod=x.HttpMethod,exports.ApiResponse=x.ApiResponse,exports.ValoryMetadata=x.ValoryMetadata,exports.RequestContext=x.RequestContext,exports.ErrorFormatter=x.ErrorFormatter,exports.ApiServer=x.ApiServer,exports.ApiMiddlewareHandler=x.ApiMiddlewareHandler,exports.ApiHandler=x.ApiHandler,exports.ApiExchange=x.ApiExchange,exports.ErrorDef=x.ErrorDef,exports.ApiMiddleware=x.ApiMiddleware,exports.VALORYLOGGERVAR=x.VALORYLOGGERVAR,exports.VALORYMETAVAR=x.VALORYMETAVAR,exports.VALORYPRETTYLOGGERVAR=x.VALORYPRETTYLOGGERVAR;
},{"./server/controller":"7BEu","./lib/defaultAdaptor":"b80R","./server/valory":"9tIP","./server/request":"8v88","./server/swagger":"Y6vY","./server/apiError":"D7a/","./server/decorators":"g1Xp","./server/valoryheaders":"Urm3"}],"GViV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("lodash"),r=require("./compiler"),t=require("./compilerheaders"),s=require("tstl"),a=require("json-schema-merge-allof"),n=require("map-keys-deep-lodash"),o=require("lodash-deep"),i=require("xxhashjs"),p="p",l=/[.]+?/g,c=/.allOf.[\d]+?.\$ref/g,f=/definitions.([^.]*).allOf.[\d]+?.\$ref/g,u=/allOf.([^.]*).\$ref/g,d=/^(?:[A-Za-z_$])(?:[0-9a-zA-Z_$]*)$/;function m(r){const t={},s=[],a={};o.deepMapValues(r,(n,o)=>{if(o.indexOf("discriminator")>-1){s.push(o);const i=o.replace(".discriminator",""),p=i+".anyOf",c="#/"+i.replace(l,"/");a[n]={parent:i.replace("definitions.",""),children:[]},e.set(r,p,[]),t[c]={propName:n,anyOfPath:p}}}),o.deepMapValues(r,(s,n)=>{if(null!=t[s]&&f.test(n)){const o="#/"+n.replace(c,"").replace(l,"/");f.lastIndex=0;const i=f.exec(n)[1];f.lastIndex=0;const p={properties:{}};p.properties[t[s].propName]={const:i},a[t[s].propName].children.push(i),e.set(r,n.replace(".$ref",""),p),e.get(r,`${t[s].anyOfPath}`).push({$ref:o})}});for(var n,i=s,p=0;p<i.length;p++)n=i[p],e.unset(r,n);return{swagger:r,discriminators:a}}function h(r){const t={};return e.forEach(r,(e,r)=>{t["t"+r]=e}),t}function g(t){const n=e.cloneDeep(t),o=new s.PriorityQueue((e,r)=>e.depth>r.depth),i=(t,s=0)=>{t.properties&&e.forEach(t.properties,e=>{i(e,s+1)}),t.anyOf&&(o.push({depth:s,schema:t}),e.forEach(t.anyOf,e=>{i(e,s+1)})),t.allOf&&e.forEach(t.allOf,e=>{i(e,s+1)}),t.items&&(e.isArray(t.items)?e.forEach(t.items,e=>{i(e,s+1)}):i(t.items,s+1)),t.additionalProperties&&i(t.additionalProperties,s+1),t.enum&&1===t.enum.length&&(t.const=t.enum[0],delete t.enum),"file"===t.type&&(r.CompileLog.debug('"file" type is implementation specific and therefore cannot be validated'),delete t.type),r.DisallowedFormats.indexOf(t.format)>-1&&(r.CompileLog.debug("removing invalid format:",t.format),delete t.format)},p=a(n);return i(p),{schema:p,resQueue:o}}function y(e){for(;!e.empty();){const r=e.top();r.schema.anyOf=h(r.schema.anyOf),e.pop()}}function O(e){const r=[];return{schema:n(e,(e,s)=>{if("enum"===s)return"api_enum";if(!d.test(s)){const e=p+i.h32(s,t.HASH_SEED).toString();return r.push({original:s,mangled:e}),e}return s}),mangledKeys:r}}exports.swaggerPreproccess=m,exports.schemaPreprocess=g,exports.resolve=y,exports.mangleKeys=O;
},{"./compiler":"c7M9","./compilerheaders":"FAPY"}],"FWCk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("lodash"),r=require("fast-json-stable-stringify");function s(r,s,i,t){const a={properties:{},required:[],type:"object"};return e.each(r.parameters,e=>{switch(e.in){case"body":a.properties.body=e.schema,a.required||(a.required=[]),a.required.push("body");break;case"header":e.name=e.name.toLowerCase();case"formData":case"query":case"path":(e=>{const r=t[e.in];let s=a.properties[r];const i={};s||(s=a.properties[r]={properties:{},required:void 0,type:"object"}),s.properties[e.name]=i;for(const r of Object.keys(e))switch(r){case"description":case"in":case"name":case"required":break;default:i[r]=e[r]}e.required&&(null==s.required&&(s.required=[]),s.required.indexOf(e.name)&&s.required.push(e.name),null==a.required&&(a.required=[]),a.required.indexOf(r)<0&&a.required.push(r))})(e)}}),a}exports.compileMethodSchema=s;
},{}],"c7M9":[function(require,module,exports) {
"use strict";var e=require("bluebird");let r=(()=>{var r=(0,e.coroutine)(function*(r,t){const i={module:null,debugArtifacts:{hashes:[],preSwagger:null,derefSwagger:null,initialSchema:[],processedSchema:[],initialCompiles:[],mangledSchema:[],intermediateFunctions:[],intermediateModule:null,postCompileModule:null,closureOutput:{exitCode:null,stderr:null,stdout:null}}},d={requestFieldMapping:{body:"body",formData:"formData",header:"headers",path:"path",query:"query"},debug:!1,singleError:!0,compilationLevel:u.CompilationLevel.ADVANCED,discrimFastFail:!1};s.merge(d,t);const p=new n({coerceTypes:!0,useDefaults:"shared",sourceCode:!0,errorDataPath:"property",unicode:!1,allErrors:!(t=d).singleError});t.discrimFastFail&&exports.CompileLog.warn("discriminator fast fail is enabled EXPERIMENTAL");const g=f.Config.Spinner;console.log(h.default.bold("Prepare Swagger")),yield(0,e.resolve)(g.start("Validating Swagger"));try{yield(0,e.resolve)(a.validate(s.cloneDeep(r)))}catch(r){yield(0,e.resolve)(m.spinnerFail("Swagger Validation Failure",r))}yield(0,e.resolve)(g.succeed()),g.start("Preprocessing Swagger");try{i.debugArtifacts.preSwagger=o.swaggerPreproccess(s.cloneDeep(r))}catch(r){yield(0,e.resolve)(m.spinnerFail("Swagger Preprocessor Failure",r))}yield(0,e.resolve)(g.succeed()),g.start("Dereferencing Swagger");try{i.debugArtifacts.derefSwagger=yield(0,e.resolve)(a.dereference(i.debugArtifacts.preSwagger.swagger))}catch(r){yield(0,e.resolve)(m.spinnerFail("Swagger Dereference Failure",r))}yield(0,e.resolve)(g.succeed()),console.log(h.default.bold("Build Endpoints"));for(const r of Object.keys(i.debugArtifacts.derefSwagger.paths))for(const s of Object.keys(i.debugArtifacts.derefSwagger.paths[r])){yield(0,e.resolve)(g.start("Building method schema"));const a=u.FUNCTION_PREFIX+w.h32(`${r}:${s}`,u.HASH_SEED).toString(),n=(exports.CompileLog.child({endpoint:`${r}:${s}`,hash:a}),l.compileMethodSchema(i.debugArtifacts.derefSwagger.paths[r][s],s,r,t.requestFieldMapping));g.text="Preprocessing schema";const c=o.schemaPreprocess(n);g.text="Compiling schema validator";const d=p.compile(c.schema);g.text="Objectifying anyOf's",o.resolve(c.resQueue),g.text="Mangling keys";const m=o.mangleKeys(c.schema);g.text="Compiling intermediate validator function";const f=S.validatorTemplate({validate:d,funcName:r,localConsumes:i.debugArtifacts.derefSwagger.paths[r][s].consumes,hash:a,format:p._opts.format,mangledKeys:m.mangledKeys,schema:m.schema,singleError:t.singleError,discriminators:i.debugArtifacts.preSwagger.discriminators,discrimFastFail:t.discrimFastFail});i.debugArtifacts.hashes.push(a),i.debugArtifacts.initialSchema.push(n),i.debugArtifacts.intermediateFunctions.push(f),i.debugArtifacts.processedSchema.push(c.schema),i.debugArtifacts.initialCompiles.push(d),i.debugArtifacts.mangledSchema.push(m),yield(0,e.resolve)(g.succeed(`${r}:${s}`))}console.log(h.default.bold("Compile")),yield(0,e.resolve)(g.start("Building intermediate module")),i.debugArtifacts.intermediateModule=S.moduleTemplate({validatorLib:i.debugArtifacts.intermediateFunctions,defHash:w.h32(JSON.stringify(r.definitions),u.HASH_SEED).toString(),exportHashes:i.debugArtifacts.hashes,swagger:r});const b=v.fileSync({prefix:"valCI"});c.writeSync(b.fd,i.debugArtifacts.intermediateModule);const F=v.fileSync({prefix:"valC"}),_={js:b.name,rewrite_polyfills:!1,compilation_level:u.CompilationLevel[t.compilationLevel],use_types_for_optimization:!0,preserve_type_annotations:!0,js_output_file:F.name,language_out:"ES5_STRICT",debug:t.debug,jscomp_off:A};yield(0,e.resolve)(g.succeed()),yield(0,e.resolve)(g.start("Running Closure Compiler: "+u.CompilationLevel[t.compilationLevel]));try{yield(0,e.resolve)(new Promise((e,r)=>{new y(_).run((t,s,a)=>{i.debugArtifacts.closureOutput.stderr=a,i.debugArtifacts.closureOutput.stdout=s,i.debugArtifacts.closureOutput.exitCode=t,t?r(a):(i.debugArtifacts.postCompileModule=c.readFileSync(F.name,{encoding:"utf8"}),e())})}))}catch(r){yield(0,e.resolve)(m.spinnerFail("Closure Compiler Failure",r))}return yield(0,e.resolve)(g.succeed()),yield(0,e.resolve)(g.start("Final post process")),i.module=C(i.debugArtifacts.postCompileModule),yield(0,e.resolve)(g.succeed()),i});return function(e,t){return r.apply(this,arguments)}})();var t=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r},i=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("lodash"),a=require("swagger-parser"),o=require("./preprocessor"),l=require("./method"),n=require("ajv"),c=t(require("fs")),u=require("./compilerheaders"),d=require("path"),p=require("../server/valoryheaders"),g=require("pino"),m=require("../lib/helpers"),f=require("../lib/config"),h=i(require("chalk"));exports.CompileLog=g({prettyPrint:"true"===process.env[p.VALORYPRETTYLOGGERVAR]});const y=require("google-closure-compiler").compiler,v=require("tmp"),b=require("dot");b.log=!1;const S=b.process({path:d.join(__dirname,"../../templates")}),A="undefinedVars",w=require("xxhashjs");function C(e){let r=e.replace(/!0/g," true");return r=(r=(r=r.replace(/!1/g," false")).replace(/void 0/g,"undefined")).replace(/([a-zA-Z]*?)=[\S\n\r]*?\"([a-zA-Z ]+?)\".split\(\" \"\)/gm,(e,r,t)=>`${r}=${JSON.stringify(t.split(" "))}`)}exports.DisallowedFormats=["float","double","int32","int64","byte","binary"],exports.compile=r;
},{"./preprocessor":"GViV","./method":"FWCk","./compilerheaders":"FAPY","../server/valoryheaders":"Urm3","../lib/helpers":"Y6jv","../lib/config":"0Kt0"}],"QHSc":[function(require,module,exports) {
"use strict";var e=require("bluebird");let r=(()=>{var r=(0,e.coroutine)(function*(r,i,a,f,d,p){const y=yield(0,e.resolve)(require("./compiler").compile(r,d)),g=t({level:process.env[n.VALORYLOGGERVAR]||"info",prettyPrint:"true"===process.env[n.VALORYPRETTYLOGGERVAR]});g.debug("Saving compiled swagger to: "+i),o.writeFileSync(i,y.module);const v=s.cloneDeep(r);if(v.paths=s.omit(v.paths,f),null!=p){o.existsSync(p)||o.mkdirSync(p);const e=Buffer.from(u()()).toString("base64");o.mkdirSync(c.join(p,e)),g.info("Placing additional debug artifacts in:",c.join(p,e));for(const r of Object.keys(y.debugArtifacts)){const i=y.debugArtifacts[r];"string"==typeof i&&o.writeFileSync(c.join(p,e,r+".js"),i)}}o.writeFileSync(l.Config.SwaggerPath,JSON.stringify(v)),o.writeFileSync(c.join(a,l.Config.SWAGGER_FILE),JSON.stringify(v))});return function(e,i,t,n,o,s){return r.apply(this,arguments)}})();var i=function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(r[i]=e[i]);return r.default=e,r};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("pino"),n=require("../server/valoryheaders"),o=require("fs"),s=require("lodash"),c=i(require("path")),l=require("../lib/config"),u=require("hyperid");exports.compileAndSave=r;
},{"./compiler":"c7M9","../server/valoryheaders":"Urm3","../lib/config":"0Kt0"}],"4pL9":[function(require,module,exports) {
"use strict";var t=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("typescript"));function n(t){const e=t.jsDoc;if(e&&e.length)return e[0].comment||void 0}function r(t,e){const n=s(t,t=>t.tagName.text===e);if(0!==n.length)return n[0].comment}function o(t){let n;if(t.kind===e.SyntaxKind.Parameter){const e=t.name.text;n=s(t.parent,t=>void 0!==t.comment&&t.comment.startsWith(e))}else n=s(t,t=>void 0!==t.comment);for(var r=n,o=t=>t.tagName.text,i=[],c=0;c<r.length;c++)i.push(o(r[c]));return i}function s(t,e){const n=t.jsDoc;if(!n||0===n.length)return[];const r=n[0];return r.tags?r.tags.filter(e):[]}function i(t,e){return 0!==s(t,e).length}exports.getJSDocDescription=n,exports.getJSDocComment=r,exports.getJSDocTagNames=o,exports.getJSDocTags=s,exports.isExistJSDocTag=i;
},{}],"jPwt":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("typescript"));class t extends Error{constructor(e,r){super(e),r&&(this.message=`${e}\n in: ${n(r)}`)}}function n(e){return e.kind===r.SyntaxKind.SourceFile?e.fileName:e.parent?n(e.parent):""}exports.GenerateMetadataError=t;
},{}],"IHsS":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("moment")),r=require("../metadataGeneration/exceptions"),a=require("./jsDocUtils");function s(e,s){if(!e.parent)return{};function n(e,t=!0){if(e){if(t){const t=e.indexOf(" ");return t>0?e.substr(t+1):void 0}return e}}return a.getJSDocTags(e.parent,e=>i().some(t=>!!e.comment&&(t===e.tagName.text&&e.comment.startsWith(s)))).reduce((e,a)=>{if(!a.comment)return e;const s=a.tagName.text,i=a.comment.substr(a.comment.indexOf(" ")+1).trim(),m=function(e){if(e)return e.split(" ")[0]}(i);switch(s){case"uniqueItems":e[s]={errorMsg:n(i,!1),value:void 0};break;case"minimum":case"maximum":case"minItems":case"maxItems":case"minLength":case"maxLength":if(isNaN(m))throw new r.GenerateMetadataError(`${s} parameter use number.`);e[s]={errorMsg:n(i),value:Number(m)};break;case"minDate":case"maxDate":if(!t(m,t.ISO_8601,!0).isValid())throw new r.GenerateMetadataError(`${s} parameter use date format ISO 8601 ex. 2017-05-14, 2017-05-14T05:18Z`);e[s]={errorMsg:n(i),value:m};break;case"pattern":if("string"!=typeof m)throw new r.GenerateMetadataError(`${s} patameter use string.`);e[s]={errorMsg:n(i),value:m};break;default:if(s.startsWith("is")){const t=n(i,!1);t&&(e[s]={errorMsg:t,value:void 0})}}return e},{})}function n(e){function s(e,t=!0){if(e){if(t){const t=e.indexOf(" ");return t>0?e.substr(t+1):void 0}return e}}return a.getJSDocTags(e,e=>i().some(t=>t===e.tagName.text)).reduce((e,a)=>{const n=a.tagName.text,i=a.comment,m=function(e){if(e)return e.split(" ")[0]}(i);switch(n){case"default":break;case"uniqueItems":e[n]={errorMsg:s(i,!1),value:void 0};break;case"minimum":case"maximum":case"minItems":case"maxItems":case"minLength":case"maxLength":if(isNaN(m))throw new r.GenerateMetadataError(`${n} parameter use number.`);e[n]={errorMsg:s(i),value:Number(m)};break;case"minDate":case"maxDate":if(!t(m,t.ISO_8601,!0).isValid())throw new r.GenerateMetadataError(`${n} parameter use date format ISO 8601 ex. 2017-05-14, 2017-05-14T05:18Z`);e[n]={errorMsg:s(i),value:m};break;case"pattern":if("string"!=typeof m)throw new r.GenerateMetadataError(`${n} patameter use string.`);e[n]={errorMsg:s(i),value:m};break;default:if(n.startsWith("is")){const t=s(i,!1);t&&(e[n]={errorMsg:t,value:void 0})}}return e},{})}function i(){return["isString","isBoolean","isInt","isLong","isFloat","isDouble","isDate","isDateTime","minItems","maxItems","uniqueItems","minLength","maxLength","pattern","minimum","maximum","minDate","maxDate"]}exports.getParameterValidators=s,exports.getPropertyValidators=n;
},{"../metadataGeneration/exceptions":"jPwt","./jsDocUtils":"4pL9"}],"71Ig":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("lodash"),n=e(require("typescript")),r=require("../utils/jsDocUtils"),a=require("../utils/validatorUtils"),i=require("./exceptions"),o=require("./metadataGenerator"),d={};d[n.SyntaxKind.NumberKeyword]="number",d[n.SyntaxKind.StringKeyword]="string",d[n.SyntaxKind.BooleanKeyword]="boolean",d[n.SyntaxKind.VoidKeyword]="void";const s={},u={};function l(e,t,r=!0){const a=y(e,t);if(a)return a;if(e.kind===n.SyntaxKind.ArrayType)return{dataType:"array",elementType:l(e.elementType)};if(e.kind===n.SyntaxKind.UnionType){const t=e;if(t.types.some(e=>e.kind===n.SyntaxKind.LiteralType)){for(var d=t.types,s=e=>{const t=e.literal;switch(t.kind){case n.SyntaxKind.TrueKeyword:return"true";case n.SyntaxKind.FalseKeyword:return"false";default:return String(t.text)}},u=[],p=0;p<d.length;p++)u.push(s(d[p]));return{dataType:"enum",enums:u}}return{dataType:"object"}}if(e.kind===n.SyntaxKind.AnyKeyword)return{dataType:"any"};if(e.kind===n.SyntaxKind.TypeLiteral){return h(e,t)}if(e.kind===n.SyntaxKind.LiteralType){const t=e;let r;switch(t.literal.kind){case n.SyntaxKind.StringLiteral:r=t.literal.text;break;case n.SyntaxKind.NumericLiteral:r=parseFloat(t.literal.text);break;default:r=String(t.literal.text)}return{dataType:"enum",enums:[r]}}if(e.kind!==n.SyntaxKind.TypeReference)throw new i.GenerateMetadataError(`Unknown type: ${n.SyntaxKind[e.kind]}`);const c=e;if(c.typeName.kind===n.SyntaxKind.Identifier){if("Date"===c.typeName.text)return f(e,t);if("Buffer"===c.typeName.text)return{dataType:"buffer"};if("Array"===c.typeName.text&&c.typeArguments&&1===c.typeArguments.length)return{dataType:"array",elementType:l(c.typeArguments[0])};if("Promise"===c.typeName.text&&c.typeArguments&&1===c.typeArguments.length)return l(c.typeArguments[0]);if("String"===c.typeName.text)return{dataType:"string"}}if(!r){const e=m(c.typeName,r);if(e)return e}const x=S(c.typeName);if(x)return x;let g;if(c.typeArguments&&1===c.typeArguments.length){const e=c.typeArguments;g=T(c.typeName,r,e)}else g=T(c.typeName,r);return o.MetadataGenerator.current.AddReferenceType(g),g}function p(e,t){if(e)switch(e.kind){case n.SyntaxKind.ArrayLiteralExpression:for(var r=e.elements,a=e=>p(e),i=[],o=0;o<r.length;o++)i.push(a(r[o]));return i;case n.SyntaxKind.StringLiteral:return e.text;case n.SyntaxKind.TrueKeyword:return!0;case n.SyntaxKind.FalseKeyword:return!1;case n.SyntaxKind.NumberKeyword:case n.SyntaxKind.FirstLiteralToken:return Number(e.text);case n.SyntaxKind.NewExpression:const m=e;if("Date"===m.expression.text){let e=new Date;if(m.arguments){for(var d=m.arguments.filter(e=>void 0!==e.kind),s=e=>p(e),u=[],l=0;l<d.length;l++)u.push(s(d[l]));const t=u;t.length>0&&(e=new Date(t))}const n=e.toISOString();return t&&"date"===t.dataType?n.split("T")[0]:n}return;case n.SyntaxKind.ObjectLiteralExpression:const x={};for(var y=e.properties,f=e=>{x[e.name.text]=p(e.initializer)},c=0;c<y.length;c++)f(y[c]);return x;default:return}}function y(e,t){const n=d[e.kind];if(n){if("number"===n){if(!t)return{dataType:"double"};const e=r.getJSDocTagNames(t).filter(e=>["isInt","isLong","isFloat","isDouble"].some(t=>t===e));if(0===e.length)return{dataType:"double"};switch(e[0]){case"isInt":return{dataType:"integer"};case"isLong":return{dataType:"long"};case"isFloat":return{dataType:"float"};case"isDouble":default:return{dataType:"double"}}}return{dataType:n}}}function f(e,t){if(!t)return{dataType:"datetime"};const n=r.getJSDocTagNames(t).filter(e=>["isDate","isDateTime"].some(t=>t===e));if(0===n.length)return{dataType:"datetime"};switch(n[0]){case"isDate":return{dataType:"date"};case"isDateTime":default:return{dataType:"datetime"}}}function c(e){if(e.kind!==n.SyntaxKind.TypeAliasDeclaration)return;const t=e;return t.type.kind!==n.SyntaxKind.IntersectionType?(t.type.kind,n.SyntaxKind.TypeReference,{type:l(e.type,e.type.parent),description:I(e),format:P(e),refName:e.name.text,validators:a.getPropertyValidators(e),dataType:"refAlias",example:x(e)}):void 0}function m(e,t=!0){const r=e.text,a=o.MetadataGenerator.current.nodes.filter(e=>e.kind===n.SyntaxKind.EnumDeclaration).filter(e=>e.name.text===r);if(!a.length)return;if(a.length>1)throw new i.GenerateMetadataError(`Multiple matching enum found for enum ${r}; please make enum names unique.`);const d=a[0];function s(e){const t=e.initializer;if(t)return t.expression?t.expression.text:t.text}if(t){for(var u=d.members,l=(e,t)=>s(e)||String(t),p=[],y=0;y<u.length;y++)p.push(l(u[y],y));const e=p;return{dataType:"refEnum",description:I(d),enums:e,refName:r}}for(var f=d.members,c=(e,t)=>s(e)||String(t),m=[],x=0;x<f.length;x++)m.push(c(f[x],x));return{dataType:"enum",enums:m}}function x(e){const t=r.getJSDocComment(e,"example");return t?JSON.parse(t):void 0}function g(e){const t=r.getJSDocComment(e,"swagger");return t?JSON.parse(t):void 0}function h(e,t){return{dataType:"object",properties:A(e),additionalProperties:G(e),description:I(null!=e.parent?e.parent:e)}}function S(e){const t=e.text,r=o.MetadataGenerator.current.nodes.filter(e=>e.kind===n.SyntaxKind.TypeAliasDeclaration).filter(e=>{const t=e.type;return t.kind===n.SyntaxKind.UnionType&&t.types}).filter(e=>e.name.text===t);if(r.length){if(r.length>1)throw new i.GenerateMetadataError(`Multiple matching enum found for enum ${t}; please make enum names unique.`);for(var a=r[0].type.types,d=e=>e.literal.text,s=[],u=0;u<a.length;u++)s.push(d(a[u]));return{dataType:"enum",enums:s}}}function T(e,t=!0,n){const r=K(e),a=k(r,n);try{const t=s[a];if(t)return t;const i=m(e,!0);if(i)return s[a]=i,i;if(u[a])return N(a);u[a]=!0;const o=D(e),d=c(o);if(d)return s[a]=d,d;const l=A(o,n),p=G(o),y=E(o)||[],f=x(o),h=g(o),S={additionalProperties:p,dataType:"refObject",description:I(o),properties:y,refName:a};return S.properties=S.properties.concat(l),s[a]=S,f&&(S.example=f),h&&(S.additionalSwagger=h),S}catch(e){throw e.message=`There was a problem resolving type of '${k(r,n)}'.\n`+e.message,e}}function K(e){if(e.kind===n.SyntaxKind.Identifier)return e.text;const t=e;return K(t.left)+"."+t.right.text}function k(e,t){if(!t||!t.length)return e;for(var n=t,r=e=>w(e),a=[],i=0;i<n.length;i++)a.push(r(n[i]));return e+a.join("")}function w(e){const t=d[e.kind];if(t)return t;if(e.kind===n.SyntaxKind.ArrayType){return w(e.elementType)+"Array"}if(e.kind===n.SyntaxKind.UnionType)return"object";if(e.kind===n.SyntaxKind.TypeLiteral)return"object";if(e.kind!==n.SyntaxKind.TypeReference)throw new i.GenerateMetadataError(`Unknown type: ${n.SyntaxKind[e.kind]}.`);const r=e;try{return r.typeName.text}catch(t){return console.error(t),e.toString()}}function N(e){const t={dataType:"refObject",refName:e};return o.MetadataGenerator.current.OnFinish(n=>{const r=n[e];r&&(t.description=r.description,t.dataType=r.dataType,t.refName=t.refName,"refAlias"===t.dataType&&"refAlias"===r.dataType?(t.validators=r.validators,t.example=r.example,t.format=r.format,t.type=r.type):t.properties=r.properties)}),t}function v(e){switch(e.kind){case n.SyntaxKind.InterfaceDeclaration:case n.SyntaxKind.ClassDeclaration:case n.SyntaxKind.TypeAliasDeclaration:case n.SyntaxKind.EnumDeclaration:return!0;default:return!1}}function M(e){for(;e.kind!==n.SyntaxKind.Identifier;)e=e.left;return e}function b(e,t){for(;e.parent&&e.parent.kind===n.SyntaxKind.QualifiedName;){const r=e.kind===n.SyntaxKind.Identifier?e.text:e.right.text,a=t.filter(e=>{if(e.kind!==n.SyntaxKind.ModuleDeclaration||!o.MetadataGenerator.current.IsExportedNode(e))return!1;return e.name.text.toLowerCase()===r.toLowerCase()});if(!a.length)throw new i.GenerateMetadataError(`No matching module declarations found for ${r}.`);if(a.length>1)throw new i.GenerateMetadataError(`Multiple matching module declarations found for ${r}; please make module declarations unique.`);const d=a[0].body;if(null===d||d.kind!==n.SyntaxKind.ModuleBlock)throw new i.GenerateMetadataError(`Module declaration found for ${r} has no body.`);t=d.statements,e=e.parent}return t}function D(e){const t=b(M(e),o.MetadataGenerator.current.nodes),a=e.kind===n.SyntaxKind.Identifier?e.text:e.right.text;let d=t.filter(e=>{if(!v(e)||!o.MetadataGenerator.current.IsExportedNode(e))return!1;return e.name.text===a});if(!d.length)throw new i.GenerateMetadataError(`No matching model found for referenced type ${a}.`);if(d.length>1){const e=(d=d.filter(e=>!(e.getSourceFile().fileName.replace(/\\/g,"/").toLowerCase().indexOf("node_modules/typescript")>-1))).filter(e=>{return r.isExistJSDocTag(e,e=>"tsoaModel"===e.tagName.text)});if(e.length>0){if(e.length>1)throw new i.GenerateMetadataError(`Multiple models for ${a} marked with '@tsoaModel'; '@tsoaModel' should only be applied to one model.`);d=e}}if(d.length>1){for(var s=d,u=e=>e.getSourceFile().fileName,l=[],p=0;p<s.length;p++)l.push(u(s[p]));const e=l.join('"; "');throw new i.GenerateMetadataError(`Multiple matching models found for referenced type ${a};\n\t\t\t please make model names unique. Conflicts found: "${e}".`)}return d[0]}function A(e,d){const s=e=>{return r.isExistJSDocTag(e,e=>"ignore"===e.tagName.text)};if(e.kind===n.SyntaxKind.InterfaceDeclaration||e.kind===n.SyntaxKind.TypeLiteral){for(var u=e.members.filter(e=>{return!s(e)&&e.kind===n.SyntaxKind.PropertySignature}),y=r=>{const o=r,s=o.name;if(!o.type)throw new i.GenerateMetadataError("No valid type found for property declaration.");let u=o.type;if(u.kind===n.SyntaxKind.TypeReference&&d&&d.length&&e.typeParameters){const n=t.map(e.typeParameters,e=>e.name.text),r=u.typeName;let a;a=r.text?r.text:r.right.text;const i=t.indexOf(n,a);i>=0&&(u=d[i])}return{description:I(o),format:P(o),name:s.text,required:!o.questionToken,type:l(u,u.parent),validators:a.getPropertyValidators(o)}},f=[],c=0;c<u.length;c++)f.push(y(u[c]));return f}if(e.kind===n.SyntaxKind.TypeAliasDeclaration){const t=e,r=[];if(t.type.kind===n.SyntaxKind.IntersectionType){for(var m=t.type.types,x=e=>{if(e.kind===n.SyntaxKind.TypeReference){const t=A(D(e.typeName));r.push(...t)}},g=0;g<m.length;g++)x(m[g])}if(t.type.kind===n.SyntaxKind.TypeReference){const e=A(D(t.type.typeName));r.push(...e)}return r}const h=e,S=h.members.filter(e=>{if(e.kind===n.SyntaxKind.MethodDeclaration)throw new i.GenerateMetadataError("Illegal method declaration on model class");return!0}).filter(e=>{return!s(e)}).filter(e=>e.kind===n.SyntaxKind.PropertyDeclaration).filter(e=>L(e)),T=h.members.find(e=>e.kind===n.SyntaxKind.Constructor);if(T&&T.parameters){const e=T.parameters.filter(e=>L(e));S.push(...e)}for(var K=S,k=r=>{const s=r.name;let u=r.type;if(!u){const e=o.MetadataGenerator.current.typeChecker.getTypeAtLocation(r);u=o.MetadataGenerator.current.typeChecker.typeToTypeNode(e)}if(!u)throw new i.GenerateMetadataError("No valid type found for property declaration.");if(u.kind===n.SyntaxKind.TypeReference&&d&&d.length&&e.typeParameters){const n=t.map(e.typeParameters,e=>e.name.text),r=u.typeName;let a;a=r.text?r.text:r.right.text;const i=t.indexOf(n,a);i>=0&&(u=d[i])}const y=l(u,r);return{default:p(r.initializer,y),description:I(r),format:P(r),name:s.text,required:!r.questionToken&&!r.initializer,type:y,validators:a.getPropertyValidators(r)}},w=[],N=0;N<K.length;N++)w.push(k(K[N]));return w}function G(e){if(e.kind===n.SyntaxKind.InterfaceDeclaration){const t=e.members.find(e=>e.kind===n.SyntaxKind.IndexSignature);if(!t)return;const r=t;if("string"!==l(r.parameters[0].type).dataType)throw new i.GenerateMetadataError("Only string indexers are supported.");return l(r.type)}}function E(e){const t=[];if(e.kind===n.SyntaxKind.TypeAliasDeclaration)return[];if(e.kind===n.SyntaxKind.TypeLiteral)return[];const r=e.heritageClauses;if(!r)return t;for(var a=r,i=e=>{if(e.types)for(var n=e.types,r=e=>{const n=T(e.expression);if(n.properties)for(var r=n.properties,a=e=>t.push(e),i=0;i<r.length;i++)a(r[i])},a=0;a<n.length;a++)r(n[a])},o=0;o<a.length;o++)i(a[o]);return t}function L(e){return!e.modifiers||e.modifiers.every(e=>e.kind!==n.SyntaxKind.ProtectedKeyword&&e.kind!==n.SyntaxKind.PrivateKeyword)}function I(e){if(e.kind===n.SyntaxKind.TypeLiteral)return;const t=o.MetadataGenerator.current.typeChecker.getSymbolAtLocation(e.name);if(!t)return;e.kind===n.SyntaxKind.Parameter&&(t.flags=0);const r=t.getDocumentationComment(void 0);return r.length?n.displayPartsToString(r):void 0}function P(e){return r.getJSDocComment(e,"format")}exports.resolveType=l,exports.getInitializerValue=p;
},{"../utils/jsDocUtils":"4pL9","../utils/validatorUtils":"IHsS","./exceptions":"jPwt","./metadataGenerator":"5wlh"}],"Tbsn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../metadataGeneration/resolveType");function t(e,t){const r=e.decorators;if(!r||!r.length)return[];for(var n=r,o=e=>{for(;void 0!==e.expression;)e=e.expression;return e},s=[],i=0;i<n.length;i++)s.push(o(n[i]));return s.filter(t)}function r(e,r){const n=t(e,r);if(n&&n.length)return n[0].text}function n(e,r){const n=t(e,r);if(!n||!n.length)return;const o=n[0].parent.arguments;return o&&o.length?o[0].text:void 0}function o(r,n){const o=t(r,n);if(!o||!o.length)return;const s=o[0].parent.arguments;return s&&s.length?e.getInitializerValue(s[0]):void 0}function s(e,r){const n=t(e,r);return!(!n||!n.length)}exports.getDecorators=t,exports.getDecoratorName=r,exports.getDecoratorTextValue=n,exports.getDecoratorOptionValue=o,exports.isDecorator=s;
},{"../metadataGeneration/resolveType":"71Ig"}],"kBZt":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("typescript")),r=require("../utils/decoratorUtils"),a=require("../utils/validatorUtils"),i=require("./exceptions"),o=require("./metadataGenerator"),s=require("./resolveType"),n=require("lodash");class p{constructor(e,t,r){this.parameter=e,this.method=t,this.path=r}Generate(){switch(r.getDecoratorName(this.parameter,e=>this.supportParameterDecorator(e.text))){case"Logger":return this.getLoggerParameter(this.parameter);case"Request":return this.getRequestParameter(this.parameter);case"Body":return this.getBodyParameter(this.parameter);case"BodyProp":return this.getBodyPropParameter(this.parameter);case"Header":return this.getHeaderParameter(this.parameter);case"Query":return this.getQueryParameter(this.parameter);case"Path":default:return this.getPathParameter(this.parameter)}}getRequestParameter(e){const t=e.name.text;return{description:this.getParameterDescription(e),in:"request",name:t,parameterName:t,required:!e.questionToken&&!e.initializer,type:{dataType:"object"},validators:a.getParameterValidators(this.parameter,t)}}getLoggerParameter(e){const t=e.name.text;return{description:"",in:"logger",name:t,parameterName:t,required:!0,type:{dataType:"object"},validators:{}}}getBodyPropParameter(e){const t=e.name.text,o=this.getValidatedType(e);if(!this.supportBodyMethod(this.method))throw new i.GenerateMetadataError(`@BodyProp('${t}') Can't support in ${this.method.toUpperCase()} method.`);return{default:s.getInitializerValue(e.initializer,o),description:this.getParameterDescription(e),in:"body-prop",name:r.getDecoratorTextValue(this.parameter,e=>"BodyProp"===e.text)||t,parameterName:t,required:!e.questionToken&&!e.initializer,type:o,validators:a.getParameterValidators(this.parameter,t)}}getBodyParameter(e){const t=e.name.text,r=this.getValidatedType(e);if(!this.supportBodyMethod(this.method))throw new i.GenerateMetadataError(`@Body('${t}') Can't support in ${this.method.toUpperCase()} method.`);return{description:this.getParameterDescription(e),in:"body",name:t,parameterName:t,required:!e.questionToken&&!e.initializer,type:r,validators:a.getParameterValidators(this.parameter,t)}}getHeaderParameter(e){const t=e.name.text;let o=this.getValidatedType(e,!1),p=null;if("refAlias"===o.dataType&&(o=(p=o).type),!this.supportPathDataType(o))throw new i.GenerateMetadataError(`@Header('${t}') Can't support '${o.dataType}' type.`);return{default:s.getInitializerValue(e.initializer,o),description:this.getParameterDescription(e)||(null!=p?p.description:void 0),in:"header",name:r.getDecoratorTextValue(this.parameter,e=>"Header"===e.text)||t,parameterName:t,required:!e.questionToken&&!e.initializer,type:o,validators:null!=p?n.merge({},p.validators,a.getParameterValidators(this.parameter,t)):a.getParameterValidators(this.parameter,t)}}getQueryParameter(e){const t=e.name.text;let o=this.getValidatedType(e,!1),p=null;if("refAlias"===o.dataType&&(o=(p=o).type),"array"===o.dataType){const e=o;if(!this.supportPathDataType(e.elementType))throw new i.GenerateMetadataError(`@Query('${t}') Can't support array '${e.elementType.dataType}' type.`)}else if(!this.supportPathDataType(o))throw new i.GenerateMetadataError(`@Query('${t}') Can't support '${o.dataType}' type.`);return{default:s.getInitializerValue(e.initializer,o),description:this.getParameterDescription(e)||(null!=p?p.description:void 0),in:"query",name:r.getDecoratorTextValue(this.parameter,e=>"Query"===e.text)||t,parameterName:t,required:!e.questionToken&&!e.initializer,type:o,validators:null!=p?n.merge({},p.validators,a.getParameterValidators(this.parameter,t)):a.getParameterValidators(this.parameter,t)}}getPathParameter(e){const t=e.name.text;let o=this.getValidatedType(e,!1);const p=r.getDecoratorTextValue(this.parameter,e=>"Path"===e.text)||t;let d=null;if("refAlias"===o.dataType&&(o=(d=o).type),!this.supportPathDataType(o))throw new i.GenerateMetadataError(`@Path('${t}') Can't support '${o.dataType}' type.`);if(!this.path.includes(`{${p}}`))throw new i.GenerateMetadataError(`@Path('${t}') Can't match in URL: '${this.path}'.`);return{default:s.getInitializerValue(e.initializer,o),description:this.getParameterDescription(e)||(null!=d?d.description:void 0),in:"path",name:p,parameterName:t,required:!0,type:o,validators:null!=d?n.merge({},d.validators,a.getParameterValidators(this.parameter,t)):a.getParameterValidators(this.parameter,t)}}getParameterDescription(e){const r=o.MetadataGenerator.current.typeChecker.getSymbolAtLocation(e.name);if(!r)return;const a=r.getDocumentationComment(void 0);return a.length?t.displayPartsToString(a):void 0}supportBodyMethod(e){return["post","put","patch"].some(t=>t===e.toLowerCase())}supportParameterDecorator(e){return["header","query","parem","body","bodyprop","request","logger"].some(t=>t===e.toLocaleLowerCase())}supportPathDataType(e){return["string","integer","long","float","double","date","datetime","buffer","boolean","enum","any"].find(t=>t===e.dataType)}getValidatedType(e,t=!0){let r=e.type;if(!r){const t=o.MetadataGenerator.current.typeChecker.getTypeAtLocation(e);r=o.MetadataGenerator.current.typeChecker.typeToTypeNode(t)}return s.resolveType(r,e,t)}}exports.ParameterGenerator=p;
},{"../utils/decoratorUtils":"Tbsn","../utils/validatorUtils":"IHsS","./exceptions":"jPwt","./metadataGenerator":"5wlh","./resolveType":"71Ig"}],"NYB/":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../utils/decoratorUtils"),t=require("../utils/jsDocUtils"),r=require("./exceptions"),n=require("./metadataGenerator"),s=require("./parameterGenerator"),o=require("./resolveType");class a{constructor(e,t,r){this.node=e,this.parentTags=t,this.parentSecurity=r,this.processMethodDecorators()}IsValid(){return!!this.method}Generate(){if(!this.IsValid())throw new r.GenerateMetadataError("This isn't a valid a controller method.");let e=this.node.type;if(!e){const t=n.MetadataGenerator.current.typeChecker,r=t.getSignatureFromDeclaration(this.node),s=t.getReturnTypeOfSignature(r);e=t.typeToTypeNode(s)}const s=o.resolveType(e),a=this.getMethodResponses();return a.push(this.getMethodSuccessResponse(s)),{deprecated:t.isExistJSDocTag(this.node,e=>"deprecated"===e.tagName.text),description:t.getJSDocDescription(this.node),isHidden:this.getIsHidden(),method:this.method,name:this.node.name.text,parameters:this.buildParameters(),path:this.path,responses:a,security:this.getSecurity(),summary:t.getJSDocComment(this.node,"summary"),tags:this.getTags(),type:s}}buildParameters(){for(var e=this.node.parameters,t=e=>{try{return new s.ParameterGenerator(e,this.method,this.path).Generate()}catch(e){const t=this.node.name,n=this.node.parent.name;throw new r.GenerateMetadataError(`${e.message} \n in '${n.text}.${t.text}'`)}},n=[],o=0;o<e.length;o++)n.push(t(e[o]));const a=n,i=a.filter(e=>"body"===e.in),h=a.filter(e=>"body-prop"===e.in);if(i.length>1)throw new r.GenerateMetadataError(`Only one body parameter allowed in '${this.getCurrentLocation()}' method.`);if(i.length>0&&h.length>0)throw new r.GenerateMetadataError(`Choose either during @Body or @BodyProp in '${this.getCurrentLocation()}' method.`);return a}getCurrentLocation(){const e=this.node.name;return`${this.node.parent.name.text}.${e.text}`}processMethodDecorators(){const t=e.getDecorators(this.node,e=>this.supportsPathMethod(e.text));if(!t||!t.length)return;if(t.length>1){for(var n=t,s=e=>e.text,o=[],a=0;a<n.length;a++)o.push(s(n[a]));throw new r.GenerateMetadataError(`Only one path decorator in '${this.getCurrentLocation}' method,\n       Found: ${o.join(", ")}`)}const i=t[0],h=i.parent.arguments[0];this.method=i.text.toLowerCase(),this.path=h?`${h.text}`:""}getMethodResponses(){const t=e.getDecorators(this.node,e=>"Response"===e.text);if(!t||!t.length)return[];for(var r=t,n=e=>{const t=e.parent;let r,n="",s="200";if(t.arguments.length>0&&t.arguments[0].text&&(s=t.arguments[0].text),t.arguments.length>1&&t.arguments[1].text&&(n=t.arguments[1].text),t.arguments.length>2&&t.arguments[2].text){const e=t.arguments[2];r=this.getExamplesValue(e)}return{description:n,examples:r,name:s,schema:t.typeArguments&&t.typeArguments.length>0?o.resolveType(t.typeArguments[0]):void 0}},s=[],a=0;a<r.length;a++)s.push(n(r[a]));return s}getMethodSuccessResponse(t){const n=e.getDecorators(this.node,e=>"SuccessResponse"===e.text);if(!n||!n.length)return{description:"void"===t.dataType?"No content":"Ok",examples:this.getMethodSuccessExamples(),name:"void"===t.dataType?"204":"200",schema:t};if(n.length>1)throw new r.GenerateMetadataError(`Only one SuccessResponse decorator allowed in '${this.getCurrentLocation}' method.`);const s=n[0].parent;let o="",a="200";return s.arguments.length>0&&s.arguments[0].text&&(a=s.arguments[0].text),s.arguments.length>1&&s.arguments[1].text&&(o=s.arguments[1].text),{description:o,examples:void 0,name:a,schema:t}}getMethodSuccessExamples(){const t=e.getDecorators(this.node,e=>"Example"===e.text);if(!t||!t.length)return;if(t.length>1)throw new r.GenerateMetadataError(`Only one Example decorator allowed in '${this.getCurrentLocation}' method.`);const n=t[0].parent.arguments[0];return this.getExamplesValue(n)}supportsPathMethod(e){return["get","post","put","patch","delete"].some(t=>t===e.toLowerCase())}getExamplesValue(e){const t={};for(var r,n=e.properties,s=0;s<n.length;s++)r=n[s],t[r.name.text]=o.getInitializerValue(r.initializer);return t}getTags(){const t=e.getDecorators(this.node,e=>"Tags"===e.text);if(!t||!t.length)return this.parentTags;if(t.length>1)throw new r.GenerateMetadataError(`Only one Tags decorator allowed in '${this.getCurrentLocation}' method.`);for(var n=t[0].parent.arguments,s=e=>e.text,o=[],a=0;a<n.length;a++)o.push(s(n[a]));const i=o;return this.parentTags&&i.push(...this.parentTags),i}getIsHidden(){const t=e.getDecorators(this.node,e=>"Hidden"===e.text);if(!t||!t.length)return!1;if(t.length>1)throw new r.GenerateMetadataError(`Only one Hidden decorator allowed in '${this.getCurrentLocation}' method.`);return!0}getSecurity(){const t=e.getDecorators(this.node,e=>"Security"===e.text);if(!t||!t.length)return this.parentSecurity||[];const r=[];for(const e of t){const t=e.parent;r.push({name:t.arguments[0].text,scopes:t.arguments[1]?t.arguments[1].elements.map(e=>e.text):void 0})}return r}}exports.MethodGenerator=a;
},{"../utils/decoratorUtils":"Tbsn","../utils/jsDocUtils":"4pL9","./exceptions":"jPwt","./metadataGenerator":"5wlh","./parameterGenerator":"kBZt","./resolveType":"71Ig"}],"/vQc":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("typescript")),r=require("../utils/decoratorUtils"),o=require("./exceptions"),n=require("./methodGenerator"),a=require("./metadataGenerator"),s=require("../../lib/config");class i{constructor(e){this.node=e,this.path=this.getPath(),this.tags=this.getTags(),this.security=this.getSecurity()}IsValid(){return!!this.path||""===this.path}Generate(){if(!this.node.parent)throw new o.GenerateMetadataError("Controller node doesn't have a valid parent source file.");if(!this.node.name)throw new o.GenerateMetadataError("Controller node doesn't have a valid name.");if(!this.isNodeExported())throw new o.GenerateMetadataError("Controller node must be exported.");const e=this.node.parent.getSourceFile();if(e.fileName===s.Config.ConfigData.sourceEntrypoint)throw new o.GenerateMetadataError("Controller node not allowed in app entrypoint.");let t=!1;const r=a.MetadataGenerator.current.typeChecker;if(null!=this.node.heritageClauses)for(var n=this.node.heritageClauses,i=e=>{for(const o of e.types){"Controller"===r.getTypeFromTypeNode(o).symbol.escapedName&&(t=!0)}},l=0;l<n.length;l++)i(n[l]);return{location:e.fileName,methods:this.buildMethods(),name:this.node.name.text,path:this.path||"",extendsController:t}}buildMethods(){for(var e=this.node.members.filter(e=>e.kind===t.SyntaxKind.MethodDeclaration),r=e=>new n.MethodGenerator(e,this.tags,this.security),o=[],a=0;a<e.length;a++)o.push(r(e[a]));for(var s=o.filter(e=>e.IsValid()),i=e=>e.Generate(),l=[],h=0;h<s.length;h++)l.push(i(s[h]));return l}getPath(){const e=r.getDecorators(this.node,e=>"Route"===e.text);if(!e||!e.length)return;if(e.length>1)throw new o.GenerateMetadataError(`Only one Route decorator allowed in '${this.node.name.text}' class.`);const t=e[0].parent.arguments[0];return t?`${t.text}`:""}getTags(){const e=r.getDecorators(this.node,e=>"Tags"===e.text);if(e&&e.length){if(e.length>1)throw new o.GenerateMetadataError(`Only one Tags decorator allowed in '${this.node.name.text}' class.`);for(var t=e[0].parent.arguments,n=e=>e.text,a=[],s=0;s<t.length;s++)a.push(n(t[s]));return a}}getSecurity(){const e=r.getDecorators(this.node,e=>"Security"===e.text);if(!e||!e.length)return[];const t=[];for(const r of e){const e=r.parent;t.push({name:e.arguments[0].text,scopes:e.arguments[1]?e.arguments[1].elements.map(e=>e.text):void 0})}return t}isNodeExported(){return 0!=(t.getCombinedModifierFlags(this.node)&t.ModifierFlags.Export)}}exports.ControllerGenerator=i;
},{"../utils/decoratorUtils":"Tbsn","./exceptions":"jPwt","./methodGenerator":"NYB/","./metadataGenerator":"5wlh","../../lib/config":"0Kt0"}],"5wlh":[function(require,module,exports) {
"use strict";var e=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r};Object.defineProperty(exports,"__esModule",{value:!0});const r=e(require("minimatch")),t=e(require("typescript")),s=require("./controllerGenerator");class n{constructor(e,r,s){this.ignorePaths=s,this.nodes=new Array,this.referenceTypeMap={},this.circularDependencyResolvers=new Array,this.program=t.createProgram([e],r||{}),this.typeChecker=this.program.getTypeChecker(),n.current=this}IsExportedNode(e){return!0}Generate(){for(var e=this.program.getSourceFiles(),s=e=>{if(this.ignorePaths&&this.ignorePaths.length)for(const t of this.ignorePaths)if(r(e.fileName,t))return;t.forEachChild(e,e=>{this.nodes.push(e)})},n=0;n<e.length;n++)s(e[n]);const i=this.buildControllers();for(var o=this.circularDependencyResolvers,a=e=>e(this.referenceTypeMap),h=0;h<o.length;h++)a(o[h]);return{controllers:i,referenceTypeMap:this.referenceTypeMap}}TypeChecker(){return this.typeChecker}AddReferenceType(e){e.refName&&(this.referenceTypeMap[e.refName]=e)}GetReferenceType(e){return this.referenceTypeMap[e]}OnFinish(e){this.circularDependencyResolvers.push(e)}buildControllers(){for(var e=this.nodes.filter(e=>e.kind===t.SyntaxKind.ClassDeclaration&&this.IsExportedNode(e)),r=e=>new s.ControllerGenerator(e),n=[],i=0;i<e.length;i++)n.push(r(e[i]));for(var o=n.filter(e=>e.IsValid()),a=e=>e.Generate(),h=[],c=0;c<o.length;c++)h.push(a(o[c]));return h}}exports.MetadataGenerator=n;
},{"./controllerGenerator":"/vQc"}],"qFFv":[function(require,module,exports) {
"use strict";function e(e,r,t,s=!0){if((!e||"/"===e)&&s)return"";e&&"string"==typeof e||(e=""+e);let n=e.replace(/^[\/\\\s]+|[\/\\\s]+$/g,"");return n=r?r+n:n,n=(n=t?n+t:n).replace(/[\/\\\s]+/g,"/")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.normalisePath=e;
},{}],"fYL1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./utils/pathUtils"),t=require("lodash");class r{constructor(e){this.metadata=e}GetSpec(){return{consumes:["application/json"],definitions:this.buildDefinitions(),info:{title:""},paths:this.buildPaths(),produces:["application/json"],swagger:"2.0"}}buildDefinitions(){const e={};for(var r=Object.keys(this.metadata.referenceTypeMap),i=r=>{const i=this.metadata.referenceTypeMap[r];if("refObject"===i.dataType||"refEnum"===i.dataType){if(i.properties){for(var a=i.properties.filter(e=>e.required),o=e=>e.name,s=[],n=0;n<a.length;n++)s.push(o(a[n]));const t=s;e[i.refName]={description:i.description,properties:this.buildProperties(i.properties),required:t&&t.length>0?Array.from(new Set(t)):void 0,type:"object"},i.additionalProperties&&(e[i.refName].additionalProperties=this.buildAdditionalProperties(i.additionalProperties))}i.example&&(e[i.refName].example=i.example),i.enums&&(e[i.refName]={description:i.description,enum:i.enums,type:"string"}),i.additionalSwagger&&(e[i.refName]=t.merge(e[i.refName],i.additionalSwagger))}if("refAlias"===i.dataType){const t=this.getSwaggerType(i.type),r=i.format;if(t.description=i.description,t.format=r||t.format,t.example=i.example,!t.$ref)for(var p=Object.keys(i.validators).filter(e=>!e.startsWith("is")&&"minDate"!==e&&"maxDate"!==e),d=e=>{t[e]=i.validators[e].value},l=0;l<p.length;l++)d(p[l]);e[i.refName]=t}},a=[],o=0;o<r.length;o++)a.push(i(r[o]));return e}buildPaths(){const t={};for(var r=this.metadata.controllers,i=r=>{const i=e.normalisePath(r.path,"/");for(var a=r.methods,o=a=>{const o=e.normalisePath(a.path,"/"),s=e.normalisePath(`${i}${o}`,"/","",!1);t[s]=t[s]||{},this.buildMethod(r.name,a,t[s])},s=0;s<a.length;s++)o(a[s])},a=0;a<r.length;a++)i(r[a]);return t}buildMethod(e,t,r){const i=r[t.method]=this.buildOperation(e,t);if(i.description=t.description,i.summary=t.summary,i.tags=t.tags,t.deprecated&&(i.deprecated=t.deprecated),t.security){const e=[];for(const r of t.security){const t={};t[r.name]=r.scopes?r.scopes:[],e.push(t)}i.security=e}for(var a=t.parameters.filter(e=>!("request"===e.in||"body-prop"===e.in||"logger"===e.in)),o=e=>this.buildParameter(e),s=[],n=0;n<a.length;n++)s.push(o(a[n]));i.parameters=s;const p=this.buildBodyPropParameter(e,t);if(p&&i.parameters.push(p),i.parameters.filter(e=>"body"===e.in).length>1)throw new Error("Only one body parameter allowed per controller method.")}buildBodyPropParameter(e,t){const r={},i=[];for(var a=t.parameters.filter(e=>"body-prop"===e.in),o=e=>{if(r[e.name]=this.getSwaggerType(e.type),r[e.name].default=e.default,r[e.name].description=e.description,"object"===e.type.dataType){const t=this.buildLiteralObject(e.type);r[e.name].properties=t.properties,r[e.name].additionalProperties=t.additionalProperties,r[e.name].required=t.required,r[e.name].type=t.type,r[e.name].description=t.description}e.required&&i.push(e.name)},s=0;s<a.length;s++)o(a[s]);if(!Object.keys(r).length)return;const n={in:"body",name:"body",schema:{properties:r,title:`${this.getOperationId(t.name)}Body`,type:"object"}};return i.length&&(n.schema.required=i),n}buildParameter(e){let t={default:e.default,description:e.description,in:e.in,name:e.name,required:e.required};const r=this.getSwaggerType(e.type);if(t.format=r.format||void 0,"query"===t.in&&"array"===t.type&&(t.collectionFormat="multi"),r.$ref)return t.schema=r,t;const i={};for(var a,o=Object.keys(e.validators).filter(e=>!e.startsWith("is")&&"minDate"!==e&&"maxDate"!==e),s=0;s<o.length;s++)a=o[s],i[a]=e.validators[a].value;return"object"===e.type.dataType&&"body"===e.in&&(t.schema=this.buildLiteralObject(e.type)),"body"===e.in&&"array"===e.type.dataType?t.schema={items:r.items,type:"array"}:"any"===e.type.dataType?"body"===e.in?t.schema={type:"object"}:t.type="string":"body"===e.in&&"object"===e.type.dataType||(t.type=r.type,t.items=r.items,t.enum=r.enum),null!=t.schema?t.schema=Object.assign({},t.schema,i):t=Object.assign({},t,i),t}buildLiteralObject(e){for(var t=e.properties.filter(e=>e.required),r=e=>e.name,i=[],a=0;a<t.length;a++)i.push(r(t[a]));const o=i,s={type:"object",properties:this.buildProperties(e.properties),required:o&&o.length>0?Array.from(new Set(o)):void 0,description:e.description};return e.additionalProperties&&(s.additionalProperties=this.buildAdditionalProperties(e.additionalProperties)),s}buildProperties(e){const t={};for(var r=e,i=e=>{const r=this.getSwaggerType(e.type),i=e.format;if(r.description=e.description,r.format=i||r.format,"object"===e.type.dataType){const t=this.buildLiteralObject(e.type);r.properties=t.properties,r.additionalProperties=t.additionalProperties,r.type=t.type,r.required=t.required,r.description=r.description?r.description:t.description}if(!r.$ref){r.default=e.default;for(var a=Object.keys(e.validators).filter(e=>!e.startsWith("is")&&"minDate"!==e&&"maxDate"!==e),o=t=>{r[t]=e.validators[t].value},s=0;s<a.length;s++)o(a[s])}t[e.name]=r},a=0;a<r.length;a++)i(r[a]);return t}buildAdditionalProperties(e){return this.getSwaggerType(e)}buildOperation(e,t){const r={};for(var i=t.responses,a=e=>{r[e.name]={description:e.description},e.schema&&"void"!==e.schema.dataType&&(r[e.name].schema=this.getSwaggerType(e.schema)),e.examples&&(r[e.name].examples={"application/json":e.examples})},o=0;o<i.length;o++)a(i[o]);return{operationId:this.getOperationId(t.name),produces:["application/json"],responses:r}}getOperationId(e){return e.charAt(0).toUpperCase()+e.substr(1)}getSwaggerType(e){const t=this.getSwaggerTypeForPrimitiveType(e);return t||("array"===e.dataType?this.getSwaggerTypeForArrayType(e):"enum"===e.dataType?this.getSwaggerTypeForEnumType(e):this.getSwaggerTypeForReferenceType(e))}getSwaggerTypeForPrimitiveType(e){return{any:{type:"object"},binary:{type:"string",format:"binary"},boolean:{type:"boolean"},buffer:{type:"string",format:"byte"},byte:{type:"string",format:"byte"},date:{type:"string",format:"date"},datetime:{type:"string",format:"date-time"},double:{type:"number",format:"double"},float:{type:"number",format:"float"},integer:{type:"integer",format:"int32"},long:{type:"integer",format:"int64"},object:{type:"object"},string:{type:"string"}}[e.dataType]}getSwaggerTypeForArrayType(e){return{type:"array",items:this.getSwaggerType(e.elementType)}}getSwaggerTypeForEnumType(e){let r=!1;for(var i,a=e.enums,o=0;o<a.length;o++)i=a[o],t.isString(i)&&(r=!0);for(var s=e.enums,n=e=>r?String(e):e,p=[],d=0;d<s.length;d++)p.push(n(s[d]));return{type:r?"string":"number",enum:p}}getSwaggerTypeForReferenceType(e){return{$ref:`#/definitions/${e.refName}`}}}exports.SpecGenerator=r;
},{"./utils/pathUtils":"qFFv"}],"gSg9":[function(require,module,exports) {
"use strict";var e=require("bluebird");let r=(()=>{var r=(0,e.coroutine)(function*(r){console.log(s.default.bold("Controller Generation"));const t=l.Config.Spinner;let u;yield(0,e.resolve)(t.start("Generating route controller metadata"));try{u=new a.MetadataGenerator(r).Generate()}catch(r){yield(0,e.resolve)(c.spinnerFail("Metadata Failure",r))}yield(0,e.resolve)(t.succeed()),yield(0,e.resolve)(t.start("Building swagger content from metadata"));const p=new o.SpecGenerator(u).GetSpec();for(var g=u.controllers,v=e=>{const t=n.relative(n.dirname(r),e.location);e.location="./"+t.replace(n.extname(t),"")},y=0;y<g.length;y++)v(g[y]);yield(0,e.resolve)(t.succeed());try{yield(0,e.resolve)(t.start("Generating routes"));const r=d.apiTemplate({swagger:p,metadata:u}),a=l.Config.SourceRoutePath;i.writeFileSync(a,r.replace(/\"([a-zA-Z_$][0-9a-zA-Z_$]+)\":/g,"$1:")),yield(0,e.resolve)(t.succeed())}catch(r){yield(0,e.resolve)(c.spinnerFail("Route Generation Failure",r))}});return function(e){return r.apply(this,arguments)}})();var t=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("./metadataGeneration/metadataGenerator"),o=require("./specGenerator"),n=require("path"),i=require("fs"),l=require("../lib/config"),s=t(require("chalk")),c=require("../lib/helpers"),u=require("dot");u.log=!1,u.templateSettings.strip=!1;const d=u.process({path:n.join(__dirname,"../../templates")});exports.routeBuild=r;
},{"./metadataGeneration/metadataGenerator":"5wlh","./specGenerator":"fYL1","../lib/config":"0Kt0","../lib/helpers":"Y6jv"}],"+l7W":[function(require,module,exports) {
"use strict";var e=require("bluebird");let o=(()=>{var o=(0,e.coroutine)(function*(o){console.log(h.default.bold(`valory compile v${n.Config.ValoryVersion}\n`)),console.log(`Project:       ${n.Config.PackageJSON.name}`),console.log(`Version:       ${n.Config.PackageJSON.version}`),console.log(`Config:        ${n.Config.ConfigPath}\n`),yield(0,e.resolve)(n.Config.checkRequirements());const t=process.hrtime();require("ts-node").register({project:p.join(__dirname,"../../tsconfig.json"),compilerOptions:{types:["node"]}}),o.prettylog&&(process.env.PRETTYLOG="true"),""!==n.Config.SourceRoutePath&&(yield(0,e.resolve)(u.routeBuild(n.Config.ConfigData.sourceEntrypoint))),console.log(h.default.bold("Appserver Warmup"));const i=n.Config.Spinner;let r;yield(0,e.resolve)(i.start("Registering routes"));try{require(""!==n.Config.ConfigData.sourceEntrypoint?n.Config.ConfigData.sourceEntrypoint:n.Config.ConfigData.entrypoint),r=JSON.parse(process.env[s.VALORYMETAVAR])}catch(o){yield(0,e.resolve)(y.spinnerFail("failed to load apperver",o))}i.succeed();const d=r.valory.swagger;d.schemes=o.schemes,d.host=o.host,d.info.version=o.apiVersion;const f=c.omitBy(d,c.isNil),g=a.CompilationLevel[o.compilationLevel];l.compileAndSave(f,n.Config.CompSwagPath,process.cwd(),r.valory.undocumentedEndpoints,{debug:o.debugMode,compilationLevel:g,singleError:o.singleError,discrimFastFail:o.discrimFastFail},o.debugArtifactPath).then(()=>{console.log("\nDone",(y.convertTime(process.hrtime(t))/1e3).toFixed(3)+"s"),m.ThreadSpinner.shutdown(),process.exit(0)})});return function(e){return o.apply(this,arguments)}})(),t=(()=>{var o=(0,e.coroutine)(function*(o){const t=yield(0,e.resolve)(f.prompt([{name:"entrypoint",message:`Path to entrypoint file. Relative to ${n.Config.RootPath}`,type:"input",validate:e=>{const o=p.resolve(p.join(n.Config.RootPath,e));return g.existsSync(o)?".js"===p.extname(o)||"Entrypoint must be a plain javascript file":"Entrypoint file does not exist"}},{name:"isTS",message:"Is this a typescript project?",type:"confirm"},{name:"sourceEntrypoint",message:`Path to ts source file for the entrypoint. Relative to ${n.Config.RootPath}`,type:"input",when:e=>e.isTS,validate:e=>{const o=p.resolve(p.join(n.Config.RootPath,e));return g.existsSync(o)?".ts"===p.extname(o)||"Entrypoint must be a typescript file":"Entrypoint file does not exist"}},{name:"singleError",message:"Enable single error mode",type:"confirm",default:!1}]));g.writeFileSync(n.Config.ConfigPath,JSON.stringify(t,null,2))});return function(e){return o.apply(this,arguments)}})();var i=function(e){if(e&&e.__esModule)return e;var o={};if(null!=e)for(var t in e)Object.hasOwnProperty.call(e,t)&&(o[t]=e[t]);return o.default=e,o},r=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("./config");process.env[n.CLI_MODE_FLAG]="true";const s=require("../main"),a=require("../compiler/compilerheaders"),l=require("../compiler/compileRunner"),c=require("lodash"),p=require("path"),u=require("../tsoa/tsoaRunner"),d=require("yargs"),f=i(require("inquirer")),g=require("fs"),m=require("thread-spin"),y=require("./helpers"),h=r(require("chalk"));function v(e){process.env.TEST_MODE="TRUE",process.env.PORT=e.port,e.prettylog&&(process.env.PRETTYLOG="true"),process.env[s.VALORYLOGGERVAR]=e.loglevel,require(n.Config.ConfigData.entrypoint)}d.option("project",{desc:"Top level of your project containing valory.json",type:"string",default:process.cwd(),alias:"p"}).command("init","Initialize valory config",e=>(e.config("project",e=>(n.Config.load(!1,e),n.Config.ConfigData)),e),t).command("compile","Compile valory project",e=>(e.options({entrypoint:{description:"Main entrypoint for the api"},host:{description:"The host for your api e.g. somewebsite.com",type:"string"},scheme:{alias:"s",description:"The access method for your api",choices:["http","https"],default:"https",type:"string"},basePath:{alias:"r",description:"Api path relative to the host. It must start with a slash.",coerce:e=>{if(e.startsWith("/"))return e;throw Error("Resource path MUST start with a '/'")},default:"/",type:"string"},outputFile:{alias:"o",desc:"File to write swagger output to.",default:p.join(process.cwd(),"swagger.json"),type:"string"},apiVersion:{desc:"Api version string",default:"1.0.0",type:"string"},singleError:{desc:"Only return a single validation error at a time",boolean:!0,default:!1},discrimFastFail:{desc:"Enables discriminator fast fail EXPERIMENTAL",boolean:!0,default:!1},compilationLevel:{alias:"l",desc:"Compilation level to pass to closure compiler",choices:["SIMPLE","ADVANCED","WHITESPACE_ONLY"],default:"ADVANCED"},debugMode:{alias:"d",desc:"Enable debug mode for the compiler.",boolean:!0,default:!1},debugArtifactPath:{alias:"a",desc:"When specified, intermediate compilation artifacts will be placed in a folder create here",type:"string"},prettylog:{desc:"Prettyify log output",boolean:!0,default:!1}}).config("project",e=>(process.env.VALORYCOMPILER="TRUE",n.Config.load(!0,e),n.Config.ConfigData)),e),e=>{o(e).then().catch(e=>{console.error(e)})}).command("test","Start a test server",e=>(e.options({entrypoint:{description:"Main entrypoint for the api"},port:{desc:"Port to run the appserver on",default:8080,type:"number"},prettylog:{desc:"Prettyify log output",boolean:!0,default:!1},loglevel:{alias:"l",desc:"logging level",type:"string",default:"info"}}).config("project",e=>(n.Config.load(!0,e),n.Config.ConfigData)),e),v).demandCommand().parse();
},{"./config":"0Kt0","../main":"ZCfc","../compiler/compilerheaders":"FAPY","../compiler/compileRunner":"QHSc","../tsoa/tsoaRunner":"gSg9","./helpers":"Y6jv"}]},{},["+l7W"], null)
//# sourceMappingURL=/cli.map